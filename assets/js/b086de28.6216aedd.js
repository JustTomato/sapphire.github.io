"use strict";(self.webpackChunksapphire=self.webpackChunksapphire||[]).push([[821],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),u=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(n),d=o,h=c["".concat(i,".").concat(d)]||c[d]||m[d]||r;return n?a.createElement(h,l(l({ref:t},p),{},{components:n})):a.createElement(h,l({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,l=new Array(r);l[0]=d;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[c]="string"==typeof e?e:o,l[1]=s;for(var u=2;u<r;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6899:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var a=n(7462),o=(n(7294),n(3905));const r={},l="Vuex",s={unversionedId:"vue/Vuex",id:"vue/Vuex",title:"Vuex",description:"\u4e00.Vuex\u57fa\u672c\u4f7f\u7528\u53ca\u7528\u6cd5",source:"@site/docs/vue/Vuex.md",sourceDirName:"vue",slug:"/vue/Vuex",permalink:"/sapphire.github.io/docs/vue/Vuex",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u8def\u7531",permalink:"/sapphire.github.io/docs/vue/Vue-Router"},next:{title:"\u624b\u5199Vue\u670d\u52a1\u7aef\u6e32\u67d3",permalink:"/sapphire.github.io/docs/vue/SSR"}},i={},u=[{value:"\u4e00.Vuex\u57fa\u672c\u4f7f\u7528\u53ca\u7528\u6cd5",id:"\u4e00vuex\u57fa\u672c\u4f7f\u7528\u53ca\u7528\u6cd5",level:2},{value:"\u4e8c.\u81ea\u5df1\u5b9e\u73b0Vuex\u6a21\u5757",id:"\u4e8c\u81ea\u5df1\u5b9e\u73b0vuex\u6a21\u5757",level:2},{value:"1.install\u65b9\u6cd5",id:"1install\u65b9\u6cd5",level:3},{value:"2.mixin\u65b9\u6cd5",id:"2mixin\u65b9\u6cd5",level:3},{value:"3.\u5b9e\u73b0state",id:"3\u5b9e\u73b0state",level:3},{value:"4.\u5b9e\u73b0getters",id:"4\u5b9e\u73b0getters",level:3},{value:"5.\u5b9e\u73b0mutations",id:"5\u5b9e\u73b0mutations",level:3},{value:"6.\u5b9e\u73b0actions",id:"6\u5b9e\u73b0actions",level:3},{value:"\u4e09.\u5b9e\u73b0\u6a21\u5757\u673a\u5236",id:"\u4e09\u5b9e\u73b0\u6a21\u5757\u673a\u5236",level:2},{value:"1.\u683c\u5f0f\u5316\u7528\u6237\u6570\u636e",id:"1\u683c\u5f0f\u5316\u7528\u6237\u6570\u636e",level:3},{value:"2.\u62bd\u79bb\u6a21\u5757\u7c7b",id:"2\u62bd\u79bb\u6a21\u5757\u7c7b",level:3},{value:"3.\u5b89\u88c5\u6a21\u5757",id:"3\u5b89\u88c5\u6a21\u5757",level:3},{value:"4.\u5b9a\u4e49\u72b6\u6001\u548c\u8ba1\u7b97\u5c5e\u6027",id:"4\u5b9a\u4e49\u72b6\u6001\u548c\u8ba1\u7b97\u5c5e\u6027",level:3},{value:"5.\u5b9e\u73b0\u547d\u540d\u7a7a\u95f4",id:"5\u5b9e\u73b0\u547d\u540d\u7a7a\u95f4",level:3},{value:"6.\u6ce8\u518c\u6a21\u5757",id:"6\u6ce8\u518c\u6a21\u5757",level:3},{value:"\u56db.\u63d2\u4ef6\u673a\u5236",id:"\u56db\u63d2\u4ef6\u673a\u5236",level:2},{value:"1.\u4f7f\u7528\u65b9\u5f0f",id:"1\u4f7f\u7528\u65b9\u5f0f",level:3},{value:"2.\u83b7\u53d6\u6700\u65b0\u72b6\u6001",id:"2\u83b7\u53d6\u6700\u65b0\u72b6\u6001",level:3},{value:"\u4e94.\u8f85\u52a9\u51fd\u6570",id:"\u4e94\u8f85\u52a9\u51fd\u6570",level:2},{value:"1.mapState\u5b9e\u73b0",id:"1mapstate\u5b9e\u73b0",level:3},{value:"2.mapGetters\u5b9e\u73b0",id:"2mapgetters\u5b9e\u73b0",level:3},{value:"3.mapMutations\u5b9e\u73b0",id:"3mapmutations\u5b9e\u73b0",level:3},{value:"4.<strong>mapActions\u5b9e\u73b0</strong>",id:"4mapactions\u5b9e\u73b0",level:3},{value:"\u516d.\u533a\u5206mutation\u548caction",id:"\u516d\u533a\u5206mutation\u548caction",level:2}],p={toc:u},c="wrapper";function m(e){let{components:t,...n}=e;return(0,o.kt)(c,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"vuex"},"Vuex"),(0,o.kt)("h2",{id:"\u4e00vuex\u57fa\u672c\u4f7f\u7528\u53ca\u7528\u6cd5"},"\u4e00.Vuex\u57fa\u672c\u4f7f\u7528\u53ca\u7528\u6cd5"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"vuex\u662fvue\u7684\u72b6\u6001\u7ba1\u7406\u5de5\u5177,\u4e3a\u4e86\u66f4\u65b9\u4fbf\u5b9e\u73b0\u591a\u4e2a\u7ec4\u4ef6\u5171\u4eab\u72b6\u6001")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import Vuex from 'vuex'\nVue.use(Vuex)\nexport default new Vuex.Store({\n  state: {\n    age: 28\n  },\n  getters: {\n    getAge(state) {\n      return state.age + 10;\n    }\n  },\n  mutations: {\n    changeAge(state, payload) {\n      state.age += payload\n    }\n  },\n  actions: {\n    changeAge({\n      commit\n    }, payload) {\n      setTimeout(() => {\n        commit('changeAge', payload);\n      }, 1000);\n    }\n  }\n})\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u7c7b\u6bd4\uff1a state \u7c7b\u6bd4\u4e3a\u7ec4\u4ef6\u7684\u72b6\u6001 \uff0cgetters\u7c7b\u6bd4\u4e3a\u7ec4\u4ef6\u7684\u8ba1\u7b97\u5c5e\u6027 \uff0c mutations\u7c7b\u6bd4\u4e3a\u7ec4\u4ef6\u4e2d\u7684\u65b9\u6cd5\uff08\u53ef\u4ee5\u66f4\u6539\u7ec4\u4ef6\u7684\u72b6\u6001\uff09\uff0cactions\u7528\u4e8e\u8fdb\u884c\u5f02\u6b65\u64cd\u4f5c\u5c06\u7ed3\u679c\u63d0\u4ea4\u7ed9mutation")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<div id="app">\n    \u6211\u7684\u5e74\u9f84\u662f: {{this.$store.state.age}}\n    <br />\n    \u6d4b\u8bd5\u7684\u5e74\u9f84\u662f: {{this.$store.getters.getAge}}\n    <br />\n    \x3c!-- dispatch\u5bf9\u5e94\u7684action --\x3e\n    <button @click="$store.dispatch(\'changeAge\',3)">\u8fc7\u4e00\u4f1a\u589e\u52a0\u5e74\u9f84</button>\n    \x3c!-- commit \u5bf9\u5e94\u7684mutation --\x3e\n    <button @click="$store.commit(\'changeAge\',5)">\u7acb\u5373\u589e\u52a0\u5e74\u9f84</button>\n</div>\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u8fd9\u4e2a$store\u5c5e\u6027\u662f\u901a\u8fc7\u6839\u5b9e\u4f8b\u4f20\u5165\u7684")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"new Vue({\n  store,\n  render: h => h(App)\n}).$mount('#app')\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5185\u90e8\u4f1a\u5c06store\u5c5e\u6027\u6302\u8f7d\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u547d\u540d\u4e3a$store,\u8fd9\u6837\u6240\u6709\u7ec4\u4ef6\u90fd\u53ef\u4ee5\u64cd\u4f5c\u540c\u4e00\u4e2astore\u5c5e\u6027")),(0,o.kt)("h2",{id:"\u4e8c\u81ea\u5df1\u5b9e\u73b0vuex\u6a21\u5757"},"\u4e8c.\u81ea\u5df1\u5b9e\u73b0Vuex\u6a21\u5757"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5b9e\u73b0\u5165\u53e3\u6587\u4ef6\uff0c\u9ed8\u8ba4\u5bfc\u51faStore\u7c7b\u548cinstall\u65b9\u6cd5")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { Store, install } from './store';\n\nexport default {\n    Store,\n    install\n}\nexport {\n    Store,\n    install\n}\n")),(0,o.kt)("h3",{id:"1install\u65b9\u6cd5"},"1.install\u65b9\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import applyMixin from './mixin'\nlet Vue;\nexport class Store {\n    constructor(options){}\n}\n\nexport const install = (_Vue) =>{\n    Vue = _Vue;\n    applyMixin(Vue);\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5f53\u6211\u4eec\u4f7f\u7528\u63d2\u4ef6\u65f6\u9ed8\u8ba4\u4f1a\u6267\u884cinstall\u65b9\u6cd5\u5e76\u4f20\u5165Vue\u7684\u6784\u9020\u51fd\u6570")),(0,o.kt)("h3",{id:"2mixin\u65b9\u6cd5"},"2.mixin\u65b9\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const applyMixin = (Vue) => {\n    Vue.mixin({\n        beforeCreate: vuexInit\n    })\n}\n\nfunction vuexInit() {\n    const options = this.$options;\n    if (options.store) { \n        // \u7ed9\u6839\u5b9e\u4f8b\u589e\u52a0$store\u5c5e\u6027\n        this.$store = options.store;\n    } else if (options.parent && options.parent.$store) {\n        // \u7ed9\u7ec4\u4ef6\u589e\u52a0$store\u5c5e\u6027\n        this.$store = options.parent.$store;\n    }\n}\nexport default applyMixin\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5c06store\u5b9e\u4f8b\u5b9a\u4e49\u5728\u6240\u6709\u7684\u7ec4\u4ef6\u5b9e\u4f8b\u4e0a")),(0,o.kt)("h3",{id:"3\u5b9e\u73b0state"},"3.\u5b9e\u73b0state"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export class Store {\n    constructor(options){\n        let state = options.state;\n        this._vm = new Vue({\n            data:{\n                $$state:state,\n            }\n        });\n    }\n    get state(){\n        return this._vm._data.$$state\n    }\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5c06\u7528\u6237\u4f20\u5165\u7684\u6570\u636e\u5b9a\u4e49\u5728vue\u7684\u5b9e\u4f8b\u4e0a \uff08\u8fd9\u4e2a\u5c31\u662fvuex\u6838\u5fc3\uff09\u4ea7\u751f\u4e00\u4e2a\u5355\u72ec\u7684vue\u5b9e\u4f8b\u8fdb\u884c\u901a\u4fe1\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\u5b9a\u4e49$\u5f00\u5934\u7684\u53d8\u91cf\u4e0d\u4f1a\u88ab\u4ee3\u7406\u5230\u5b9e\u4f8b\u4e0a")),(0,o.kt)("h3",{id:"4\u5b9e\u73b0getters"},"4.\u5b9e\u73b0getters"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"this.getters = {};\nconst computed = {}\nforEachValue(options.getters, (fn, key) => {\n    computed[key] = () => {\n        return fn(this.state);\n    }\n    Object.defineProperty(this.getters,key,{\n        get:()=> this._vm[key]\n    })\n});\nthis._vm = new Vue({\n    data: {\n        $$state: state,\n    },\n    computed // \u5229\u7528\u8ba1\u7b97\u5c5e\u6027\u5b9e\u73b0\u7f13\u5b58\n});\n")),(0,o.kt)("h3",{id:"5\u5b9e\u73b0mutations"},"5.\u5b9e\u73b0mutations"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export class Store {\n    constructor(options) {\n        this.mutations = {};\n        forEachValue(options.mutations, (fn, key) => {\n            this.mutations[key] = (payload) => fn.call(this, this.state, payload)\n        });\n    }\n    commit = (type, payload) => {\n        this.mutations[type](payload);\n    }\n}\n")),(0,o.kt)("h3",{id:"6\u5b9e\u73b0actions"},"6.\u5b9e\u73b0actions"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export class Store {\n    constructor(options) {\n        this.actions = {};\n        forEachValue(options.actions, (fn, key) => {\n            this.actions[key] = (payload) => fn.call(this, this,payload);\n        });\n    }\n    dispatch = (type, payload) => {\n        this.actions[type](payload);\n    }\n}\n")),(0,o.kt)("h2",{id:"\u4e09\u5b9e\u73b0\u6a21\u5757\u673a\u5236"},"\u4e09.\u5b9e\u73b0\u6a21\u5757\u673a\u5236"),(0,o.kt)("h3",{id:"1\u683c\u5f0f\u5316\u7528\u6237\u6570\u636e"},"1.\u683c\u5f0f\u5316\u7528\u6237\u6570\u636e"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import ModuleCollection from './module/module-collection'\nthis._modules = new ModuleCollection(options);\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { forEachValue } from '../util'\nexport default class ModuleCollection {\n    constructor(options) {\n        this.register([], options)\n    }\n    register(path, rootModule) {\n        let newModule = {\n            _raw: rootModule,\n            _children: {},\n            state: rootModule.state\n        };\n        if (path.length == 0) {\n            this.root = newModule;\n        } else {\n            let parent = path.slice(0,-1).reduce((memo,current)=>{\n                return memo._children[current];\n            },this.root);\n            parent._children[path[path.length-1]] = newModule;\n        }\n        if (rootModule.modules) {\n            forEachValue(rootModule.modules, (module, moduleName) => {\n                this.register(path.concat(moduleName), module);\n            })\n        }\n    }\n}\n")),(0,o.kt)("h3",{id:"2\u62bd\u79bb\u6a21\u5757\u7c7b"},"2.\u62bd\u79bb\u6a21\u5757\u7c7b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export default class Module{\n    constructor(rawModule){\n        this._children = {};\n        this._rawModule = rawModule;\n        this.state = rawModule.state\n    }\n    getChild(key){\n        return this._children[key]\n    }\n    addChild(key,module){\n        this._children[key] = module\n    }\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u540e\u7eed\u6211\u4eec\u5bf9\u6a21\u5757\u6269\u5c55\u4f1a\u66f4\u52a0\u7684\u65b9\u4fbf\uff0c\u54c8\u54c8~")),(0,o.kt)("h3",{id:"3\u5b89\u88c5\u6a21\u5757"},"3.\u5b89\u88c5\u6a21\u5757"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"this._actions = {};\nthis._mutations = {};\nthis._wrappedGetters = {}\n// \u5b89\u88c5\u6a21\u5757\ninstallModule(this, state, [], this._modules.root);\n")),(0,o.kt)("p",null,"\u5728\u6a21\u5757\u7c7b\u4e2d\u63d0\u4f9b\u904d\u5386\u65b9\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export default class Module {\n    constructor(rawModule) {\n        this._children = {};\n        this._rawModule = rawModule;\n        this.state = rawModule.state\n    }\n    getChild(key) {\n        return this._children[key]\n    }\n    addChild(key, module) {\n        this._children[key] = module\n    }\n    forEachMutation(fn) {\n        if (this._rawModule.mutations) {\n            forEachValue(this._rawModule.mutations, fn)\n        }\n    }\n    forEachAction(fn) {\n        if (this._rawModule.actions) {\n            forEachValue(this._rawModule.actions, fn)\n        }\n    }\n    forEachGetter(fn) {\n        if (this._rawModule.getters) {\n            forEachValue(this._rawModule.getters, fn)\n        }\n    }\n    forEachChild(fn) {\n        forEachValue(this._children, fn);\n    }\n}\n")),(0,o.kt)("p",null,"\u5bf9\u6a21\u5757\u8fdb\u884c\u5b89\u88c5\u64cd\u4f5c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function installModule(store, rootState, path, module) {\n    if (path.length > 0) {\n        let parent = path.slice(0, -1).reduce((memo, current) => {\n            return memo[current];\n        }, rootState);\n        Vue.set(parent, path[path.length - 1], module.state);\n    }\n    module.forEachMutation((mutation, key) => {\n        store._mutations[key] = (store._mutations[key] || []);\n        store._mutations[key].push((payload) => {\n            mutation.call(store, module.state, payload);\n        });\n    });\n    module.forEachAction((action, key) => {\n        store._actions[key] = (store._actions[key] || []);\n        store._actions[key].push(function(payload) {\n            action.call(store, this, payload);\n        });\n    });\n    module.forEachGetter((getter, key) => {\n        store._wrappedGetters[key] = function() {\n            return getter(module.state);\n        }\n    });\n    module.forEachChild((child, key) => {\n        installModule(store, rootState, path.concat(key), child)\n    })\n}\n")),(0,o.kt)("p",null,"\u5bf9",(0,o.kt)("inlineCode",{parentName:"p"},"dispatch"),"\u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"action"),"\u65b9\u6cd5\u8fdb\u884c\u91cd\u5199"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"commit = (type, payload) => {\n    this._mutations[type].forEach(fn => fn.call(this, payload));\n}\ndispatch = (type, payload) => {\n    this._actions[type].forEach(fn => fn.call(this, payload));\n}\n")),(0,o.kt)("h3",{id:"4\u5b9a\u4e49\u72b6\u6001\u548c\u8ba1\u7b97\u5c5e\u6027"},"4.\u5b9a\u4e49\u72b6\u6001\u548c\u8ba1\u7b97\u5c5e\u6027"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"resetStoreVM(this, state);\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function resetStoreVM(store, state) {\n    const computed = {};\n    store.getters = {};\n    const wrappedGetters = store._wrappedGetters\n    forEachValue(wrappedGetters, (fn, key) => {\n        computed[key] = () => {\n            return fn(store.state);\n        }\n        Object.defineProperty(store.getters, key, {\n            get: () => store._vm[key]\n        })\n    });\n    store._vm = new Vue({\n        data: {\n            $$state: state,\n        },\n        computed\n    });\n}\n")),(0,o.kt)("h3",{id:"5\u5b9e\u73b0\u547d\u540d\u7a7a\u95f4"},"5.\u5b9e\u73b0\u547d\u540d\u7a7a\u95f4"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { forEachValue } from '../util';\nimport Module from './module';\nexport default class ModuleCollection {\n    getNamespace(path) {\n        let module = this.root\n        return path.reduce((namespace, key) => {\n            module = module.getChild(key);\n            console.log(module)\n            return namespace + (module.namespaced ? key + '/' : '')\n        }, '');\n    }\n}\nexport default class Module {\n    get namespaced(){\n        return !!this._rawModule.namespaced;\n    }\n}\n")),(0,o.kt)("p",null,"\u5728\u7ed1\u5b9a\u5c5e\u6027\u662f\u589e\u52a0\u547d\u540d\u7a7a\u95f4\u5373\u53ef"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function installModule(store, rootState, path, module) {\n    let namespace = store._modules.getNamespace(path);\n    if (path.length > 0) {\n        let parent = path.slice(0, -1).reduce((memo, current) => {\n            return memo[current];\n        }, rootState);\n        Vue.set(parent, path[path.length - 1], module.state);\n    }\n    module.forEachMutation((mutation, key) => {\n        store._mutations[namespace + key] = (store._mutations[namespace + key] || []);\n        store._mutations[namespace + key].push((payload) => {\n            mutation.call(store, module.state, payload);\n        });\n    });\n    module.forEachAction((action, key) => {\n        store._actions[namespace + key] = (store._actions[namespace + key] || []);\n        store._actions[namespace + key].push(function(payload) {\n            action.call(store, this, payload);\n        });\n    });\n    module.forEachGetter((getter, key) => {\n        store._wrappedGetters[namespace + key] = function() {\n            return getter(module.state);\n        }\n    });\n    module.forEachChild((child, key) => {\n        installModule(store, rootState, path.concat(key), child)\n    })\n}\n")),(0,o.kt)("h3",{id:"6\u6ce8\u518c\u6a21\u5757"},"6.\u6ce8\u518c\u6a21\u5757"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"registerModule(path,rawModule){\n    if(typeof path == 'string') path = [path];\n    this._modules.register(path, rawModule);\n    installModule(this, this.state, path, rawModule.rawModule);\n    // \u91cd\u65b0\u8bbe\u7f6estate, \u66f4\u65b0getters\n    resetStoreVM(this,this.state);\n} \n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5b9e\u73b0\u6a21\u5757\u7684\u6ce8\u518c\uff0c\u5c31\u662f\u5c06\u5f53\u524d\u6a21\u5757\u6ce8\u518c\u5230_modules\u4e2d")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function resetStoreVM(store, state) {\n+   let oldVm = store._vm;\n    const computed = {};\n    store.getters = {};\n    const wrappedGetters = store._wrappedGetters\n    forEachValue(wrappedGetters, (fn, key) => {\n        computed[key] = () => {\n            return fn(store.state);\n        }\n        Object.defineProperty(store.getters, key, {\n            get: () => store._vm[key]\n        })\n    });\n    store._vm = new Vue({\n        data: {\n            $$state: state,\n        },\n        computed\n    });\n    if(oldVm){\n+      Vue.nextTick(() => oldVm.$destroy())\n    }\n}\n")),(0,o.kt)("p",null,"\u9500\u6bc1\u4e0a\u6b21\u521b\u5efa\u7684\u5b9e\u4f8b"),(0,o.kt)("h2",{id:"\u56db\u63d2\u4ef6\u673a\u5236"},"\u56db.\u63d2\u4ef6\u673a\u5236"),(0,o.kt)("h3",{id:"1\u4f7f\u7528\u65b9\u5f0f"},"1.\u4f7f\u7528\u65b9\u5f0f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function persists(store) { // \u6bcf\u6b21\u53bb\u670d\u52a1\u5668\u4e0a\u62c9\u53bb\u6700\u65b0\u7684 session\u3001local\n    let local = localStorage.getItem('VUEX:state');\n    if (local) {\n        store.replaceState(JSON.parse(local)); // \u4f1a\u7528local\u66ff\u6362\u6389\u6240\u6709\u7684\u72b6\u6001\n    }\n    store.subscribe((mutation, state) => {\n        // \u8fd9\u91cc\u9700\u8981\u505a\u4e00\u4e2a\u8282\u6d41  throttle lodash\n        localStorage.setItem('VUEX:state', JSON.stringify(state));\n    });\n}\nplugins: [\n    persists\n]\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u6211\u4eec\u8981\u5b9e\u73b0subscribe\u3001replaceState\u65b9\u6cd5")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u6267\u884c\u63d2\u4ef6\noptions.plugins.forEach(plugin => plugin(this));\nsubscribe(fn){\n    this._subscribers.push(fn);\n}\nreplaceState(state){\n    this._vm._data.$$state = state;\n}\n")),(0,o.kt)("h3",{id:"2\u83b7\u53d6\u6700\u65b0\u72b6\u6001"},"2.\u83b7\u53d6\u6700\u65b0\u72b6\u6001"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function getState(store, path) {\n    let local = path.reduce((newState, current) => {\n        return newState[current]; \n    }, store.state);\n    return local\n}\nmodule.forEachMutation((mutation, key) => {\n    store._mutations[namespace + key] = (store._mutations[namespace + key] || []);\n    store._mutations[namespace + key].push((payload) => {\n    mutation.call(store, getState(store,path), payload);\n    });\n});\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u8c03\u7528mutation\u65f6\u4f20\u5165\u6700\u65b0\u72b6\u6001")),(0,o.kt)("h2",{id:"\u4e94\u8f85\u52a9\u51fd\u6570"},"\u4e94.\u8f85\u52a9\u51fd\u6570"),(0,o.kt)("h3",{id:"1mapstate\u5b9e\u73b0"},"1.mapState\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const mapState = arrList => {\n  let obj = {};\n  for (let i = 0; i < arrList.length; i++) {\n    let stateName = arrList[i];\n    obj[stateName] = function() {\n      return this.$store.state[stateName];\n    };\n  }\n  return obj;\n};\n")),(0,o.kt)("h3",{id:"2mapgetters\u5b9e\u73b0"},"2.mapGetters\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const mapGetters = arrList => {\n  let obj = {};\n  for (let i = 0; i < arrList.length; i++) {\n    let getterName = arrList[i]\n    obj[getterName] = function() {\n      return this.$store.getters[getterName];\n    };  \n  }\n  return obj;\n};\n")),(0,o.kt)("h3",{id:"3mapmutations\u5b9e\u73b0"},"3.mapMutations\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const mapMutations = mutationList=>{\n    let obj = {};\n    for (let i = 0; i < mutationList.length; i++) {\n        let type = mutationList[i]\n        obj[type] = function(payload){\n            this.$store.commit(type,payload);\n        }\n    }\n    return obj\n}\n")),(0,o.kt)("h3",{id:"4mapactions\u5b9e\u73b0"},"4.",(0,o.kt)("strong",{parentName:"h3"},"mapActions\u5b9e\u73b0")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const mapActions = actionList=>{\n    let obj = {};\n    for (let i = 0; i < actionList.length; i++) {\n        let type = actionList[i]\n        obj[type] = function(payload){\n            this.$store.dispatch(type,payload);\n        }\n    }\n    return obj\n}\n")),(0,o.kt)("h2",{id:"\u516d\u533a\u5206mutation\u548caction"},"\u516d.\u533a\u5206mutation\u548caction"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"this._committing = false;\n _withCommitting(fn) {\n    let committing = this._committing;\n    this._committing = true; // \u5728\u51fd\u6570\u8c03\u7528\u524d \u8868\u793a_committing\u4e3atrue\n    fn();\n    this._committing = committing;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"if (store.strict) {\n    // \u53ea\u8981\u72b6\u6001\u4e00\u53d8\u5316\u4f1a\u7acb\u5373\u6267\u884c,\u5728\u72b6\u6001\u53d8\u5316\u540e\u540c\u6b65\u6267\u884c\n    store._vm.$watch(() => store._vm._data.$$state, () => {\n        console.assert(store._committing, '\u5728mutation\u4e4b\u5916\u66f4\u6539\u4e86\u72b6\u6001')\n    }, { deep: true, sync: true });\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u4e25\u683c\u6a21\u5f0f\u4e0b\u589e\u52a0\u540c\u6b65watcher\uff0c\u76d1\u63a7\u72b6\u6001\u53d8\u5316")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"store._withCommitting(() => {\n    mutation.call(store, getState(store, path), payload); // \u8fd9\u91cc\u66f4\u6539\u72b6\u6001\n})\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u53ea\u6709\u901a\u8fc7mutation\u66f4\u6539\u72b6\u6001\uff0c\u65ad\u8a00\u624d\u80fd\u901a\u8fc7")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"replaceState(newState) { // \u7528\u6700\u65b0\u7684\u72b6\u6001\u66ff\u6362\u6389\n    this._withCommitting(() => {\n        this._vm._data.$$state = newState;\n    })\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"store._withCommitting(() => {\n    Vue.set(parent, path[path.length - 1], module.state);\n})\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5185\u90e8\u66f4\u6539\u72b6\u6001\u5c5e\u4e8e\u6b63\u5e38\u66f4\u65b0,\u6240\u4ee5\u4e5f\u9700\u8981\u7528_withCommitting\u8fdb\u884c\u5305\u88f9")))}m.isMDXComponent=!0}}]);