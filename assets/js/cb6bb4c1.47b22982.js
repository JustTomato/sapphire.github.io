"use strict";(self.webpackChunksapphire=self.webpackChunksapphire||[]).push([[778],{3905:(e,n,t)=>{t.d(n,{Zo:()=>i,kt:()=>m});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=o.createContext({}),p=function(e){var n=o.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},i=function(e){var n=p(e.components);return o.createElement(c.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},x=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),u=p(t),x=r,m=u["".concat(c,".").concat(x)]||u[x]||d[x]||a;return t?o.createElement(m,s(s({ref:n},i),{},{components:t})):o.createElement(m,s({ref:n},i))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,s=new Array(a);s[0]=x;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l[u]="string"==typeof e?e:r,s[1]=l;for(var p=2;p<a;p++)s[p]=t[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,t)}x.displayName="MDXCreateElement"},4961:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var o=t(7462),r=(t(7294),t(3905));const a={},s="Koa",l={unversionedId:"node/Koa",id:"node/Koa",title:"Koa",description:"1.Koa\u7b80\u4ecb",source:"@site/docs/node/Koa.md",sourceDirName:"node",slug:"/node/Koa",permalink:"/sapphire.github.io/docs/node/Koa",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Cookie\u548cSession",permalink:"/sapphire.github.io/docs/node/CookieandSession"},next:{title:"Express",permalink:"/sapphire.github.io/docs/node/Express"}},c={},p=[{value:"1.Koa\u7b80\u4ecb",id:"1koa\u7b80\u4ecb",level:3},{value:"2.\u4f7f\u7528Koa",id:"2\u4f7f\u7528koa",level:3},{value:"3.\u5c1d\u8bd5\u81ea\u5df1\u5b9e\u73b0Koa",id:"3\u5c1d\u8bd5\u81ea\u5df1\u5b9e\u73b0koa",level:3},{value:"4.Koa\u7684\u5e94\u7528",id:"4koa\u7684\u5e94\u7528",level:3}],i={toc:p},u="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,o.Z)({},i,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"koa"},"Koa"),(0,r.kt)("h3",{id:"1koa\u7b80\u4ecb"},"1.Koa\u7b80\u4ecb"),(0,r.kt)("p",null,"\u5b98\u7f51\u5730\u5740\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://www.koajs.com.cn/#introduction"},"Koa(koa.js)\u4e2d\u6587\u7f51 -- \u57fa\u4e8e Node.js \u5e73\u53f0\u7684\u4e0b\u4e00\u4ee3 web \u5f00\u53d1\u6846\u67b6 (koajs.com.cn)")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Koa\u662f\u6709Express\u539f\u73ed\u4eba\u9a6c\u5f00\u53d1\u7684\u3002\u7531\u4e8eExpress\u51fa\u73b0\u5f97\u6bd4\u8f83\u65e9\uff0c\u5728Express\u4e2d\u662f\u91c7\u7528\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\uff0c\u800c\u81ea\u4eceES6\u51fa\u73b0\u4e4b\u540e\u3002\u6211\u4eec\u5927\u591a\u6570\u7684\u4ee3\u7801\u90fd\u662fasync/await\u5b9e\u73b0\u7684\u3002\u800cKoa\u4e5f\u91c7\u7528\u4e86\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0\uff0c\u53e6\u5916Koa\u5bf9\u6bd4Express\u5728\u7528\u9014\u4e0a\u5e76\u65e0\u5dee\u522b\uff0cKoa\u4f53\u79ef\u76f8\u5bf9Express\u5c11\u4e86\u5f88\u591a\u5c01\u88c5\u4e2d\u95f4\u4ef6\uff0c\u663e\u5f97\u66f4\u5c0f\u66f4\u7075\u6d3b\u3002\u81f3\u4e8e\u91c7\u7528Koa\u4ea6\u6216\u662fExpress\u9879\u76ee\u9700\u6c42\u800c\u5b9a\u3002")),(0,r.kt)("p",null,"\u6ce8\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://eggjs.github.io/zh/guide/"},"Egg.js"),"\u662f\u57fa\u4e8eKoa\u5c01\u88c5\u7684"),(0,r.kt)("h3",{id:"2\u4f7f\u7528koa"},"2.\u4f7f\u7528Koa"),(0,r.kt)("p",null,"1.\u5b89\u88c5Koa"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5148\u521d\u59cb\u5316\u9879\u76ee",(0,r.kt)("inlineCode",{parentName:"p"}," npm init -y"),"\u5e76\u4e14\u5b89\u88c5Koa",(0,r.kt)("inlineCode",{parentName:"p"},"npm install koa"))),(0,r.kt)("p",null,"2.Koa\u7528\u6cd5"),(0,r.kt)("p",null,"\u5feb\u901f\u521b\u5efa\u4e00\u4e2a\u670d\u52a1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//use \u4e3a\u6ce8\u518c\u51fd\u6570\u65b9\u6cd5\n//ctx Koa\u4e0a\u4e0b\u6587\uff0cctx\u662f\u5bf9\u539f\u751f\u7684req\u548cres\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u5c01\u88c5\u6210\u4e86\u4e00\u4e2a\u65b0\u7684\u53c2\u6570 request\u548cresponse\u3010ctx\u4e0a\u65e2\u6709\u539f\u751f\u7684req\u548cres\u4e5f\u6709Koa\u81ea\u5df1\u5c01\u88c5\u7684request\u548cresponse\u3011\n\nconst Koa = require('koa')\nconst app = new Koa(); //\u521b\u5efaKoa\u5e94\u7528\n\napp.use(function(ctx){ \n//\u6b64\u5904\u7684function\u76f8\u5f53\u4e8eNode\u4e2dHttp\u670d\u52a1\u4e2dhandleRequest\u65b9\u6cd5\n//\u800chandleRequest\u65b9\u6cd5\u4e2d\u662f\u6709req\u548cres\u4e24\u4e2a\u53c2\u6570\u7684\u3002\u4f46\u662fKoa\u76f4\u63a5\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e0a\u4e0b\u6587\u7684\u6982\u5ff5ctx\uff0c\u56e0\u4e3a\u5728Node\u4e2d\u9700\u8981\u81ea\u5df1\u57fa\u4e8ereq\u548cres\u53c2\u6570\u5904\u7406\u81ea\u5df1\u6240\u9700\u8981\u7684\u6570\u636e\uff08\u50cf\u5904\u7406Path\u5904\u7406URL\uff09\u3002\u6240\u4ee5Koa\u76f4\u63a5\u5c01\u88c5\u597d\u4e86\u4e00\u4e2a\u5bf9\u8c61\u7ed9\u6211\u4eec\u4f7f\u7528\n    //ctx\u662fKoa\u4e2d\u7684\u4e0a\u4e0b\u6587\n    //\u6b64\u5904\u63a5\u6536\u5230\u54cd\u5e94\u4e4b\u540e\n    ctx.body = 'hello'\n})\n//\u76d1\u542c3000\u7aef\u53e3\napp.listen(3000)\n")),(0,r.kt)("p",null,"\u67e5\u770bKoa\u7684\u6587\u4ef6\u7ed3\u6784"),(0,r.kt)("p",null,"1.\u5728node_modules\u6587\u4ef6\u4e2d\u627eKoa\u6587\u4ef6\u5939\uff0c\u5176\u6b21\u627epackage.json\u6587\u4ef6\u4e2d\u7684main\u5b57\u6bb5\u3010main\u5b57\u6bb5\u4e3a\u5165\u53e3\u6587\u4ef6\u3011"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},' "main": "lib/application.js",')),(0,r.kt)("p",null,"2.\u6839\u636emain\u5b57\u6bb5\u67e5\u770blib\u6587\u4ef6\u5939\uff0clib\u6587\u4ef6\u5939\u53ea\u6709\u56db\u4e2a\u6587\u4ef6\uff0c\u5373\u8fd9\u56db\u4e2a\u6587\u4ef6\u4e3aKoa\u7684\u4e3b\u8981\u6587\u4ef6\u3002\u5206\u522b\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"application.js")," ",(0,r.kt)("inlineCode",{parentName:"p"},"request.js"),"  ",(0,r.kt)("inlineCode",{parentName:"p"},"response.js"),"  ",(0,r.kt)("inlineCode",{parentName:"p"},"context.js")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"application.js"),"\u4e3a\u9879\u76ee\u7684\u6838\u5fc3"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"context.js"),"\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e3a\u4e0a\u4e0b\u6587")),(0,r.kt)("h3",{id:"3\u5c1d\u8bd5\u81ea\u5df1\u5b9e\u73b0koa"},"3.\u5c1d\u8bd5\u81ea\u5df1\u5b9e\u73b0Koa"),(0,r.kt)("p",null,"1.\u65b0\u5efaKoa\u6587\u4ef6\u5939\uff0c\u5e76\u5728koa\u6587\u4ef6\u5939\u4e2d\u65b0\u5efapackage.json\u6587\u4ef6"),(0,r.kt)("p",null,"2.\u5728package.json\u6587\u4ef6\u4e2d\u589e\u52a0main\u5b57\u6bb5 ","[\u6574\u4e2a\u5e94\u7528\u7684\u5165\u53e3]"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "main":"./lib/application.js"\n}\n')),(0,r.kt)("p",null,"3.\u65b0\u5efalib\u6587\u4ef6\u5939\u5e76\u65b0\u5efaapplication.js\u6587\u4ef6"),(0,r.kt)("p",null,"\u5148\u7b80\u5355\u5730\u5b9e\u73b0\u4e00\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"\nconst http = require('http')\nclass Application {\n    use(fn) {\n        this.fn = fn;//\u5c06use\u4e2d\u7684\u53c2\u6570\u4fdd\u5b58\u5230\u5b9e\u4f8b\u4e0a\n    }\n    handleRequest(req, res) {\n        this.fn(req, res)\n    }\n    listen(...args) {\n        let server = http.createServer(this.handleRequest.bind(this));\n        server.listen(...args)\n    }\n}\n\nmodule.exports = Application\n")),(0,r.kt)("p",null,"\u7528\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('./koa')\nconst app = new Koa(); //\u521b\u5efaKoa\u5e94\u7528\napp.use(function(req,res){ \n  res.end('hello11')\n})\napp.listen(3000)\n")),(0,r.kt)("p",null,"\u7ee7\u7eed\u5b8c\u5584 - \u5b9e\u73b0Koa\u7684ctx\u4e0a\u4e0b\u6587\u5bf9\u8c61 \u3010\u53ea\u8981\u8bb0\u4f4f\u5e26res\u548creq\u5c31\u662f\u539f\u751f\u7684\uff0c\u4e0d\u5e26\u5219\u662fkoa\u5c01\u88c5\u7684\u3011\u3001"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"console.log(ctx.req.url)//\u539f\u751f\u7684req\u5bf9\u8c61\nconsole.log(ctx.request.req.url)//\u539f\u751f\u7684req\u5bf9\u8c61\n\nconsole.log(ctx.request.url) //koa\u81ea\u5df1\u5c01\u88c5\u7684\nconsole.log(ctx.path)//koa\u81ea\u5df1\u5c01\u88c5\u7684\n")),(0,r.kt)("p",null,"\u5728lib\u4e2d\u65b0\u5efarequest.js\u3001response.js\u548ccontext.js\u6587\u4ef6"),(0,r.kt)("p",null,"\u6ce8\u610f\uff1a\u5f53\u6211\u4eec\u5728\u5e94\u7528\u4e2d\u53bb\u4fee\u6539ctx.request\u5bf9\u8c61\u65f6\uff0c\u4f8b\u5982",(0,r.kt)("inlineCode",{parentName:"p"}," ctx.request.x = 1"),"\uff0c\u800c\u6211\u4eec\u53c8\u53ef\u4ee5new Koa \u591a\u6b21\u521b\u5efa\u591a\u4e2a\u670d\u52a1\u3002\u4f46\u662f\u6211\u4eec\u5e0c\u671bcontext\u662f\u72ec\u7acb\u7684\uff01\u6240\u4ee5\u5728\u521b\u5efa\u65b0\u7684\u5e94\u7528\u65f6context\u90fd\u662f\u4e00\u4e2a\u65b0\u7684\uff01\u89e3\u51b3\u529e\u6cd5",(0,r.kt)("inlineCode",{parentName:"p"},"Object.create(context)")),(0,r.kt)("p",null,"\u6d4b\u8bd5\u4f7f\u7528\u7528\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'//1.\nconst Koa = require(\'./koa\')\n\nconst app = new Koa(); //\u521b\u5efaKoa\u5e94\u7528\n\n//2.Koa\u4e09\u4e2a\u6838\u5fc3\u7684API\u5206\u522b\u662flisen,use,on(\'error)\napp.use(function(ctx){ \n//\u6b64\u5904\u7684function\u76f8\u5f53\u4e8eNode\u4e2dHttp\u670d\u52a1\u4e2dhandleRequest\u65b9\u6cd5\n//\u800chandleRequest\u65b9\u6cd5\u4e2d\u662f\u6709req\u548cres\u4e24\u4e2a\u53c2\u6570\u7684\u3002\u4f46\u662fKoa\u76f4\u63a5\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e0a\u4e0b\u6587\u7684\u6982\u5ff5ctx\uff0c\u56e0\u4e3a\u5728Node\u4e2d\u9700\u8981\u81ea\u5df1\u57fa\u4e8ereq\u548cres\u53c2\u6570\u5904\u7406\u81ea\u5df1\u6240\u9700\u8981\u7684\u6570\u636e\uff08\u50cf\u5904\u7406Path\u5904\u7406URL\uff09\u3002\u6240\u4ee5Koa\u76f4\u63a5\u5c01\u88c5\u597d\u4e86\u4e00\u4e2a\u5bf9\u8c61\u7ed9\u6211\u4eec\u4f7f\u7528\n    //ctx\u662fKoa\u4e2d\u7684\u4e0a\u4e0b\u6587\n    //\u6b64\u5904\u63a5\u6536\u5230\u54cd\u5e94\u4e4b\u540e\n    console.log(ctx.req.url)//\u539f\u751f\u7684req\u5bf9\u8c61\n    console.log(ctx.request.req.url)//\u539f\u751f\u7684req\u5bf9\u8c61\n\n    console.log(ctx.request.path) //koa\u81ea\u5df1\u5c01\u88c5\u7684\n    console.log(ctx.path)//koa\u81ea\u5df1\u5c01\u88c5\u7684\n\n\n    ctx.body = "hello";\n    ctx.body = "world";\n    //ctx.body \u5e76\u4e0d\u662fres.end(\'xxx\')\u65b9\u6cd5\uff0c\u56e0\u4e3actx.body\u53ef\u4ee5\u4f7f\u7528\u591a\u6b21\uff0c\u4e14\u53ea\u53d6\u6700\u540e\u53d6\u4e00\u6b21\u3002\u4f46\u662fres.end()\u4e0d\u80fd\u4f7f\u7528\u591a\u6b21\n    console.log(ctx.response.body);\n\n    //\u6216\u8005\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\n    ctx.response.body = "hello";\n    ctx.response.body = "world";\n    console.log(ctx.body);\n   \n})\n//\u76d1\u542c3000\u7aef\u53e3\napp.listen(3000)\n\n\n//use \u4e3a\u6ce8\u518c\u51fd\u6570\u65b9\u6cd5\n//ctx Koa\u4e0a\u4e0b\u6587\uff0cctx\u662f\u5bf9\u539f\u751f\u7684req\u548cres\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u5c01\u88c5\u6210\u4e86\u4e00\u4e2a\u65b0\u7684\u53c2\u6570 request\u548cresponse\u3010ctx\u4e0a\u65e2\u6709\u539f\u751f\u7684req\u548cres\u4e5f\u6709Koa\u81ea\u5df1\u5c01\u88c5\u7684request\u548cresponse\u3011\n')),(0,r.kt)("p",null,"application.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst context = require('./context');\nconst request = require('./request');\nconst response = require('./response');\nclass Application {\n    constructor() {\n        //\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u7684\u628arequest\u8d4b\u503c\u7ed9context\uff0c\u5982\u679c\u5176\u4e2d\u7684\u4e00\u4e2a\u5e94\u7528\u6539\u53d8\u4e86request\u548cresponse\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u4ed6\u7684\u5e94\u7528\u4e5f\u8ddf\u7740\u4e00\u5757\u6539\n        this.context = Object.create(context);//\u6b64\u65b9\u6cd5\u7528\u4e8e\u7ee7\u627f\uff0c\u53ef\u4ee5\u7ee7\u627f\u539f\u672c\u7684\u5c5e\u6027\uff0c\u4f46\u662f\u7528\u6237\u65b0\u6269\u5c55\u7684\u5c5e\u6027\u4e0d\u4f1a\u5f71\u54cd\u539f\u6765\u7684\u4e0a\u4e0b\u6587\n        //\u5373this.context\u968f\u4fbf\u600e\u4e48\u6dfb\u52a0\u5c5e\u6027\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230context!\n        this.request = Object.create(request);\n        this.response = Object.create(response);\n    }\n    use(fn) {\n        this.fn = fn;//\u5c06use\u4e2d\u7684\u53c2\u6570\u4fdd\u5b58\u5230\u5b9e\u4f8b\u4e0a\n    }\n    createContext(req, res) {\n        // let ctx = this.context; //\u8fd9\u6837\u8d4b\u503c\uff0c\u4f1a\u5bfc\u81f4\u540c\u4e2a\u5e94\u7528\u7684\u591a\u6b21\u8bf7\u6c42\u4e5f\u662f\u7528\u7684\u540c\u4e00\u4e2a\u4e0a\u4e0b\u6587\uff0c\u4e0d\u5408\u7406\n        //\u6bcf\u6b21\u8bf7\u6c42\u90fd\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4e0a\u4e0b\u6587\n        let ctx = Object.create(this.context);\n        let request = Object.create(this.request);\n        let response = Object.create(this.response);\n        // ctx.req = req;\n        // ctx.res = res;\n        ctx.request = request;\n        ctx.response = response;\n        ctx.request.req = ctx.req = req;\n        ctx.response.res = ctx.res = res;\n        return ctx\n    }\n    handleRequest(req, res) {\n        let ctx = this.createContext(req, res)\n        //\u9ed8\u8ba4\u6ca1\u6709\u8c03\u7528fn\u65b9\u6cd5\u65f6\uff0c\u5c31\u9ed8\u8ba4\u7ed9404\n        res.statusCode= 404;\n        this.fn(ctx)\n        //\u7528\u6237\u591a\u6b21\u8bbe\u7f6e\uff0c\u53ea\u91c7\u7528\u6700\u540e\u4e00\u6b21\n        let body = ctx.body;\n        if(typeof body == 'string' || Buffer.isBuffer(body)){\n            res.end(ctx.body)\n        }else{\n            res.end('Not Found')\n        }\n        \n    }\n    listen(...args) {\n        let server = http.createServer(this.handleRequest.bind(this));\n        server.listen(...args)\n    }\n}\n\nmodule.exports = Application\n")),(0,r.kt)("p",null,"context.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"let proto = {\n\n}\nmodule.exports = proto;\n\n\nfunction defineGetter(target, key) {\n    proto.__defineGetter__(key, function () {\n        return this[target][key]\n    })\n}\nfunction defineSetter(target, key) {\n    proto.__defineSetter__(key, function (value) {\n        this[target][key] = value\n    })\n}\ndefineGetter('request', 'path');\ndefineGetter('request', 'url');\ndefineGetter('response', 'body');\ndefineSetter('response', 'body');\n")),(0,r.kt)("p",null,"request.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const url = require('url')\nmodule.exports = {\n    get path() { //\u7b49\u4ef7\u4e0eObject.defineProperty\n        // console.log(this) ctx.request\n        // console.log(this.req.url)\n        let { pathname } = url.parse(this.req.url);\n        return pathname\n    },\n    get query() {\n        let { query } = url.parse(this.req.url, true);\n        return query\n    },\n    get header(){\n\n    }\n}\n")),(0,r.kt)("p",null,"response.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n    //\u4e00\u822c\u65e2\u80fd\u8bbe\u7f6e\u53c8\u80fd\u53d6\u503c\uff0c\u9700\u8981\u4e00\u4e2a\u7b2c\u4e09\u65b9\u6765\u63a7\u5236\n    _body:undefined,\n    get body() {\n        return this._body;\n    },\n    set body(val) {\n        //\u5f53\u7ed9ctx.body\u8bbe\u7f6e\u503c\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u8bbe\u7f6e\u72b6\u6001\u4e3a200\n        this.res.statusCode = 200;\n        this._body = val;\n    }\n    \n}\n")),(0,r.kt)("p",null,"\u8bfb\u53d6\u6587\u4ef6\u5e76\u8fd4\u56de \u91c7\u7528\u6d41\u7684\u65b9\u5f0f"),(0,r.kt)("p",null,"\u6d4b\u8bd5\u4f8b\u5b50"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('./koa')\nconst fs = require('fs')\nconst path = require('path')\nconst app = new Koa(); \n\napp.use(function(ctx){ \n    //\u8bfb\u53d6\u5185\u5bb9\n    //\u6d41\u7684\u683c\u5f0f\n    ctx.set('Content-Type','text/html')//\u8bbe\u7f6e\u54cd\u5e94\u5934\n    ctx.body= fs.createReadStream(path.resolve(__dirname,'a.html'))\n    //json\u683c\u5f0f\n    //ctx.body={\"a\":\"1\"}\n})\n//\u76d1\u542c3000\u7aef\u53e3\napp.listen(3000)\n")),(0,r.kt)("p",null,"1.\u5728\u6839\u76ee\u5f55\u65b0\u5efaa.html\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n</head>\n<body>\n    \u8fd9\u662f\u8bfb\u53d6\u6587\u4ef6\n</body>\n</html>\n')),(0,r.kt)("p",null,"\u589e\u52a0\u6d41\u548cJSON\u7684\u5904\u7406 application.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst Stream = require('stream');\nconst context = require('./context');\nconst request = require('./request');\nconst response = require('./response');\nclass Application {\n    constructor() {\n        //\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u7684\u628arequest\u8d4b\u503c\u7ed9context\uff0c\u5982\u679c\u5176\u4e2d\u7684\u4e00\u4e2a\u5e94\u7528\u6539\u53d8\u4e86request\u548cresponse\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u4ed6\u7684\u5e94\u7528\u4e5f\u8ddf\u7740\u4e00\u5757\u6539\n        this.context = Object.create(context);//\u6b64\u65b9\u6cd5\u7528\u4e8e\u7ee7\u627f\uff0c\u53ef\u4ee5\u7ee7\u627f\u539f\u672c\u7684\u5c5e\u6027\uff0c\u4f46\u662f\u7528\u6237\u65b0\u6269\u5c55\u7684\u5c5e\u6027\u4e0d\u4f1a\u5f71\u54cd\u539f\u6765\u7684\u4e0a\u4e0b\u6587\n        //\u5373this.context\u968f\u4fbf\u600e\u4e48\u6dfb\u52a0\u5c5e\u6027\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230context!\n        this.request = Object.create(request);\n        this.response = Object.create(response);\n    }\n    use(fn) {\n        this.fn = fn;//\u5c06use\u4e2d\u7684\u53c2\u6570\u4fdd\u5b58\u5230\u5b9e\u4f8b\u4e0a\n    }\n    createContext(req, res) {\n        // let ctx = this.context; //\u8fd9\u6837\u8d4b\u503c\uff0c\u4f1a\u5bfc\u81f4\u540c\u4e2a\u5e94\u7528\u7684\u591a\u6b21\u8bf7\u6c42\u4e5f\u662f\u7528\u7684\u540c\u4e00\u4e2a\u4e0a\u4e0b\u6587\uff0c\u4e0d\u5408\u7406\n        //\u6bcf\u6b21\u8bf7\u6c42\u90fd\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4e0a\u4e0b\u6587\n        let ctx = Object.create(this.context);\n        let request = Object.create(this.request);\n        let response = Object.create(this.response);\n        // ctx.req = req;\n        // ctx.res = res;\n        ctx.request = request;\n        ctx.response = response;\n        ctx.request.req = ctx.req = req;\n        ctx.response.res = ctx.res = res;\n        return ctx\n    }\n    handleRequest(req, res) {\n        let ctx = this.createContext(req, res)\n        //\u9ed8\u8ba4\u6ca1\u6709\u8c03\u7528fn\u65b9\u6cd5\u65f6\uff0c\u5c31\u9ed8\u8ba4\u7ed9404\n        res.statusCode = 404;\n        this.fn(ctx)\n        //\u7528\u6237\u591a\u6b21\u8bbe\u7f6e\uff0c\u53ea\u91c7\u7528\u6700\u540e\u4e00\u6b21\n        let body = ctx.body;\n        if (typeof body == 'string' || Buffer.isBuffer(body)) {\n            res.end(ctx.body)\n        } else if (body instanceof Stream) {\n            //\u8bbe\u7f6e\u6210\u4e0b\u8f7d\u529f\u80fd\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u5934\u90e8\u5373\u53ef\n            // res.setHeader('Content-Disposition',`attachment;filename=${encodeURIComponent('\u4e0b\u8f7d')}`);\n            body.pipe(res);\n        }else if(typeof body =='object'){\n            res.end(JSON.stringify(body))\n        } \n        else {\n            res.end('Not Found')\n        }\n\n    }\n    listen(...args) {\n        let server = http.createServer(this.handleRequest.bind(this));\n        server.listen(...args)\n    }\n}\n\nmodule.exports = Application\n")),(0,r.kt)("p",null,"\u5b9e\u73b0\u4e2d\u95f4\u4ef6"),(0,r.kt)("p",null,"\u4e2d\u95f4\u4ef6\u7684\u7528\u5904"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"1.\u53ef\u4ee5\u51b3\u5b9a\u662f\u5426\u7ee7\u7eed\u5411\u4e0b\u6267\u884c\u3002\u3010\u5e38\u89c1\u7684\u4f7f\u7528\u573a\u666f\u662f\u505a\u6743\u9650\uff1a\u5bf9\u8bbf\u95ee\u8def\u5f84\u8fdb\u7edf\u4e00\u7684\u62e6\u622a\uff0c\u5982\u679c\u8def\u5f84\u4e0d\u5408\u6cd5\u5219\u4e0d\u5fc5\u5411\u4e0b\u6267\u884c\u3011\n2.\u53ef\u4ee5\u5728\u4e2d\u95f4\u4ef6\u4e2d\u62d3\u5c55\u5c5e\u6027\u6216\u8005\u6dfb\u52a0\u65b9\u6cd5\uff0c\u3010\u4ece\u7b2c\u4e00\u4e2a\u4e2d\u95f4\u62d3\u5c55\u4e00\u4e2a\u65b9\u6cd5\u4e4b\u540e\uff0c\u540e\u9762\u7684\u4e2d\u95f4\u4ef6\u90fd\u53ef\u4ee5\u83b7\u53d6\u5f97\u5230\u3011\n3.\u53ef\u4ee5\u57fa\u4e8e\u4e2d\u95f4\u4ef6\u5199\u4e00\u4e2a\u9700\u8981\u7684\u63d2\u4ef6\u3010\u5206\u5272\u903b\u8f91\u3011")),(0,r.kt)("p",null,"Koa\u4e2d\u7684\u7279\u70b9\u5f52\u7eb3"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Koa\u4e2d\u6240\u6709\u7684\u4ee3\u7801\u90fd\u8981\u643a\u7a0bpromise\u624d\u7b26\u5408\u89c4\u8303")),(0,r.kt)("p",null,"1.Koa\u4e2d\u6240\u6709\u7684use\u51fd\u6570\u4e2d\u4f20\u5165\u7684\u65b9\u6cd5\u90fd\u4f1a\u88ab\u5305\u88c5\u6210promise\u3010\u65e0\u8bba\u5728\u4f20\u5165\u7684\u65b9\u6cd5\u524d\u9762\u52a0\u4e0d\u52a0async\u3011"),(0,r.kt)("p",null,"2.\u4f1a\u628a\u6240\u6709\u7684promise\u96c6\u5408\u53d8\u6210\u4e00\u4e2apromise\u94fe\u3010\u60f3\u8ba9\u6bcf\u4e2a\u4e2d\u95f4\u4ef6\u4f9d\u6b21\u6267\u884c\uff0c\u5219\u9700\u8981\u5728next\u65b9\u6cd5\u524d\u9762\u52a0await\u6216\u8005return\u3002\u3010return\uff1a\u4e00\u4e2apromise\u8fd4\u56de\u4e00\u4e2apromise\u3011\u3011\u4f8b\u5982"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\napp.use(async function(ctx,next){\n    console.log(ctx.a)\n    //await next()\n    return next()\n})\n\napp.use(async function(ctx,next){\n    console.log(ctx.a)\n    await next()\n})\napp.listen(3000)\n")),(0,r.kt)("p",null,"3.\u6240\u6709\u7684\u5f02\u6b65\u903b\u8f91\u4ee3\u7801\u90fd\u9700\u8981\u5305\u88c5\u6210promise\u3010koa\u7684\u89c4\u8303\u8981\u6c42\u3011"),(0,r.kt)("p",null,"\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u9898\u3010\u6d0b\u8471\u6a21\u578b\u3011"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\napp.use(async function(ctx,next){\n    console.log(1)\n    next()\n    console.log(2)\n})\napp.use(async function(ctx,next){\n    console.log(3)\n    await next()\n    console.log(4)\n})\n\napp.use(async function(ctx,next){\n    console.log(5)\n    await next()\n    console.log(6)\n})\napp.listen(3000)\n//135642\n//\u89e3\u6790\uff1a\n//\u5176\u5b9e\u8ddfnext\u524d\u9762\u52a0\u4e0d\u52a0await\u6ca1\u5173\u7cfb\u3002\u4e0d\u52a0\u8f93\u51fa\u7684\u7ed3\u679c\u4e5f\u662f\u4e00\u6837\u7684\u3002\u5373\u6d0b\u8471\u6a21\u578b\n//\u3010console.log(1)\u3010console.log(3)\u3010console.log(5)console.log(6)\u3011 console.log(4)\u3011console.log(2)\u3011\u4ece\u5750\u5230\u53f3\u4f9d\u6b21\u6267\u884c\n")),(0,r.kt)("p",null,"\u4f7f\u7528\u4e00\u4e2a\u4f8b\u5b50\u6765\u89e3\u91ca\u4e3a\u4ec0\u4e48await\u524d\u9762\u4e00\u5b9a\u9700\u8981\u52a0await"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\nconst sleep= function(){\n    return new Promise((resolve,reject)=>{\n        setTimeout(()=>{\n            resolve();\n            console.log('sleep')\n        },1000)\n    })\n}\napp.use(async function(ctx,next){\n    console.log(1)\n    next()\n    console.log(2)\n})\napp.use(async function(ctx,next){\n    console.log(3)\n    await sleep()\n    next()\n    console.log(4)\n})\napp.use(async function(ctx,next){\n    console.log(5)\n    next()\n    console.log(6)\n})\napp.listen(3000)\n\n//1 3 2 sleep 5 6 4\n\n//\u8fd9\u91cc\u628anext\u65b9\u6cd5\u5f53\u4f5c\u662f\u4e0b\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u6574\u4f53\uff0c\u5c31\u6bd4\u8f83\u5bb9\u6613\u7406\u89e3\u4e86\u3002\n//\u5f53\u4ee3\u7801\u6267\u884c\u5230\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u65f6\uff0c\u6253\u5370\u51fa\u67651\uff0c\u6267\u884c\u5230next\u51fd\u6570\uff0c\u7531\u4e8e\u6ca1\u6709await\uff0c\u5219\u4e0d\u7b49\u5f85\uff0c\u6267\u884c\u4e0b\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u8f93\u51fa3\uff0c\u63a5\u7740\u6267\u884c\u5230\u4e86await sleep\u65b9\u6cd5\n//\u7531\u4e8esleep\u524d\u9762\u6709await\uff0c\u5219\u9700\u8981\u7b49\u5f85\uff0c\u4f46\u662f\u4e0d\u963b\u585e\u4ee3\u7801\u7ee7\u7eed\u5411\u4e0b\u6267\u884c\u5230next()\u524d\uff0c\u6240\u4ee5\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u6267\u884c\u5b8c\u6bd5\u8f93\u51fa2\n//\u63a5\u7740\u4ee3\u7801\u7ee7\u7eed\u5411\u4e0b\u6267\u884c\uff0c\u8f93\u51fa5 \u7136\u540e\u8f93\u51fa6 \u8f93\u51fa4\n")),(0,r.kt)("p",null,"\u5982\u679c\u662f\u5728\u7b2c\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u52a0\u4e86\u4e00\u4e2aawait"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\nconst sleep= function(){\n    return new Promise((resolve,reject)=>{\n        setTimeout(()=>{\n            resolve();\n            console.log('sleep')\n        },1000)\n    })\n}\napp.use(async function(ctx,next){\n    console.log(1)\n    await next()\n    console.log(2)\n})\napp.use(async function(ctx,next){\n    console.log(3)\n    await sleep()\n    next()\n    console.log(4)\n})\napp.use(async function(ctx,next){\n    console.log(5)\n    next()\n    console.log(6)\n})\napp.listen(3000)\n//1 3 sleep 5 6 4 2\n")),(0,r.kt)("p",null,"\u7ec8\u4e0a\u6240\u8ff0\uff0c\u5982\u679c\u5b58\u5728\u5f02\u6b65\u4ee3\u7801\u5219\u9700\u8981\u52a0await \uff0c\u4f46\u662f\u4e3a\u4e86\u89c4\u8303\u6211\u4eec\u662f\u6bcf\u4e00\u4e2a\u90fd\u52a0await"),(0,r.kt)("p",null,"\u518d\u6765\u4e00\u4e2a\u76f4\u63a5\u7684\u4f8b\u5b50"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\nconst sleep= function(){\n    return new Promise((resolve,reject)=>{\n        setTimeout(()=>{\n            resolve();\n            console.log('sleep')\n        },1000)\n    })\n}\napp.use(async function(ctx,next){\n    ctx.body = 1\n    next()\n    ctx.body = 2\n})\napp.use(async function(ctx,next){\n    ctx.body = 3\n    await sleep()\n    next()\n    ctx.body = 4\n})\napp.use(async function(ctx,next){\n    ctx.body = 5\n    next()\n    ctx.body = 6\n})\napp.listen(3000)\n\n//\u9875\u9762\u4e0a\u663e\u793a\u7684\u662f2\uff0c\u4e00\u4e2apromise\u4f1a\u7b49\u5f85\u53e6\u4e00\u4e2apromise\u7684\u6267\u884c\uff01\n\nconst Koa = require('koa');\nconst app = new Koa();\nconst sleep= function(){\n    return new Promise((resolve,reject)=>{\n        setTimeout(()=>{\n            resolve();\n            console.log('sleep')\n        },1000)\n    })\n}\napp.use(async function(ctx,next){ \n    ctx.body = 1\n    await next()\n    ctx.body = 2\n})\napp.use(async function(ctx,next){\n    ctx.body = 3\n    await sleep()\n    next()\n    ctx.body = 4\n})\napp.use(async function(ctx,next){\n    ctx.body = 5\n    next()\n    ctx.body = 6\n})\napp.listen(3000)\n//\u4f1a\u7b49\u5f851\u79d2\u4e4b\u540e\u9875\u9762\u624d\u8f93\u51fa2\n")),(0,r.kt)("p",null,"\u90a3\u6d0b\u8471\u6a21\u578b\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f\u53ef\u4ee5\u7528\u6765\u8ba1\u65f6\uff0c\u4ece\u7b2c\u4e00\u4e2a\u4ee3\u7801\u6267\u884c\u5230\u5b8c\u6210\u8017\u65f6\u591a\u5c11"),(0,r.kt)("p",null,"Koa1.0\u4f7f\u7528\u7684\u662fgenerator\uff0c\u5df2\u7ecf\u4e0d\u4f7f\u7528\u4e86\u3002Koa2.0\u4f7f\u7528\u7684\u662fasync/await"),(0,r.kt)("p",null,"\u624b\u52a8\u5b9e\u73b0Koa\u7684\u4e2d\u95f4\u4ef6 - application.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst Stream = require('stream');\nconst context = require('./context');\nconst request = require('./request');\nconst response = require('./response');\nclass Application {\n    constructor() {\n        //\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u7684\u628arequest\u8d4b\u503c\u7ed9context\uff0c\u5982\u679c\u5176\u4e2d\u7684\u4e00\u4e2a\u5e94\u7528\u6539\u53d8\u4e86request\u548cresponse\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u4ed6\u7684\u5e94\u7528\u4e5f\u8ddf\u7740\u4e00\u5757\u6539\n        this.context = Object.create(context);//\u6b64\u65b9\u6cd5\u7528\u4e8e\u7ee7\u627f\uff0c\u53ef\u4ee5\u7ee7\u627f\u539f\u672c\u7684\u5c5e\u6027\uff0c\u4f46\u662f\u7528\u6237\u65b0\u6269\u5c55\u7684\u5c5e\u6027\u4e0d\u4f1a\u5f71\u54cd\u539f\u6765\u7684\u4e0a\u4e0b\u6587\n        //\u5373this.context\u968f\u4fbf\u600e\u4e48\u6dfb\u52a0\u5c5e\u6027\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230context!\n        this.request = Object.create(request);\n        this.response = Object.create(response);\n        //\u5b58\u50a8\u4e2d\u95f4\u4ef7\u7684\u6570\u7ec4\n        this.middlewares = [];\n    }\n    use(fn) {\n        // this.fn = fn;//\u5c06use\u4e2d\u7684\u53c2\u6570\u4fdd\u5b58\u5230\u5b9e\u4f8b\u4e0a\n        this.middlewares.push(fn)\n    }\n    createContext(req, res) {\n        // let ctx = this.context; //\u8fd9\u6837\u8d4b\u503c\uff0c\u4f1a\u5bfc\u81f4\u540c\u4e2a\u5e94\u7528\u7684\u591a\u6b21\u8bf7\u6c42\u4e5f\u662f\u7528\u7684\u540c\u4e00\u4e2a\u4e0a\u4e0b\u6587\uff0c\u4e0d\u5408\u7406\n        //\u6bcf\u6b21\u8bf7\u6c42\u90fd\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4e0a\u4e0b\u6587\n        let ctx = Object.create(this.context);\n        let request = Object.create(this.request);\n        let response = Object.create(this.response);\n        // ctx.req = req;\n        // ctx.res = res;\n        ctx.request = request;\n        ctx.response = response;\n        ctx.request.req = ctx.req = req;\n        ctx.response.res = ctx.res = res;\n        return ctx\n    }\n    compose(ctx){\n        //\u9700\u8981\u5c06\u591a\u4e2a\u51fd\u6570\u7ec4\u5408\n        //\u603b\u7ed3\uff1a\u5f02\u6b65\u8fed\u4ee3\u7528\u51fd\u6570\uff0c\u540c\u6b65\u8fed\u4ee3\u7528\u5faa\u73af\n        let index = -1;\n        const dispatch = (i) => {\n            //use\u65b9\u6cd5\u53ef\u80fd\u4e00\u4e2a\u51fd\u6570\u90fd\u6ca1\u4f20\n            if(index <= i) return Promise.reject('next() called multiples');\n            if(this.middlewares.length == i) return Promise.resolve();\n            index = i;\n            let middleware = this.middlewares[i];\n            return Promise.resolve(middleware(ctx,()=>dispatch(i+1)));\n        }\n        return dispatch(0)\n    }\n    handleRequest(req, res) {\n        let ctx = this.createContext(req, res)\n        //\u9ed8\u8ba4\u6ca1\u6709\u8c03\u7528fn\u65b9\u6cd5\u65f6\uff0c\u5c31\u9ed8\u8ba4\u7ed9404\n        res.statusCode = 404;\n        //compose\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2apromise\n        this.compose(ctx).then(() => {\n            //\u7528\u6237\u591a\u6b21\u8bbe\u7f6e\uff0c\u53ea\u91c7\u7528\u6700\u540e\u4e00\u6b21\n            let body = ctx.body;\n            if (typeof body == 'string' || Buffer.isBuffer(body)) {\n                res.end(ctx.body)\n            } else if (body instanceof Stream) {\n                //\u8bbe\u7f6e\u6210\u4e0b\u8f7d\u529f\u80fd\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u5934\u90e8\u5373\u53ef\n                // res.setHeader('Content-Disposition',`attachment;filename=${encodeURIComponent('\u4e0b\u8f7d')}`);\n                body.pipe(res);\n            } else if (typeof body == 'object') {\n                res.end(JSON.stringify(body))\n            }\n            else {\n                res.end('Not Found')\n            }\n        })\n    }\n    listen(...args) {\n        let server = http.createServer(this.handleRequest.bind(this));\n        server.listen(...args)\n    }\n}\n\nmodule.exports = Application\n")),(0,r.kt)("p",null,"\u5b9e\u73b0bodyParse\u63d2\u4ef6"),(0,r.kt)("p",null,"\u80cc\u666f\uff1a\u670d\u52a1\u7aef\u6709\u53ef\u80fd\u4ece\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u7528\u6237\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u670d\u52a1\u7aef\u9700\u8981\u8fdb\u884c\u5c06\u8bf6\u6536\u6570\u636e\u5e76\u54cd\u5e94\uff08\u4f8b\u5982Ajax\uff09"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//\u670d\u52a1\u7aef\u6709\u53ef\u80fd\u4ece\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u7528\u6237\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u670d\u52a1\u7aef\u9700\u8981\u8fdb\u884c\u5c06\u8bf6\u6536\u6570\u636e\u5e76\u54cd\u5e94\uff08\u4f8b\u5982Ajax\uff09\nconst Koa = require('koa');\nconst app = new Koa();\n\n//\u5047\u8bbe\uff1a\n//1.\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee/login\u4e14\u4e3aget\u65f6\uff0c\u670d\u52a1\u7aef\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u767b\u5f55\u9875\n//\u6ce8\u91ca\uff1a\u8868\u5355\u63d0\u4ea4\u6ca1\u6709\u8de8\u57df\u7684\u95ee\u9898\uff0c\u8de8\u57df\u662f\u6d4f\u89c8\u5668\u672c\u8eab\u7684\u95ee\u9898;\napp.use(async (ctx,next) => {\n    if(ctx.path ==='/login' && ctx.method === 'GET'){\n        ctx.body = `<form action=\"/login\" method=\"post\">\n            <input type=\"text\" name=\"username\" />\n            <input type=\"text\" name=\"password\" />\n            <button>\u63d0\u4ea4</button>\n        </form>`\n    }else{\n        await next()\n    }\n})\n\n//2.\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee/login\u4e14\u4e3apost\u65f6\uff0c\u670d\u52a1\u7aef\u9700\u8981\u505a\u767b\u5f55\u64cd\u4f5c\napp.use(async (ctx,next) => {\n    if(ctx.path ==='/login' && ctx.method === 'POST'){\n        let arr= []\n       ctx.req.on('data',function(chunk){\n        arr.push(chunk)\n       });\n       ctx.req.on('end',function(){\n        console.log(Buffer.concat(arr).toString())//username=123&password=321\n        ctx.set('Content-Type','text/html;charset=utf-8')\n        ctx.body = Buffer.concat(arr); \n        //\u8fd9\u4e00\u6b65\u5e76\u4e0d\u4f1a\u628a\u5ba2\u6237\u7aef\u63d0\u4ea4\u7684\u6570\u636e\u53cd\u663e\u5230\u9875\u9762\u4e0a\u3002\u56e0\u4e3afunction\u8fd9\u4e2a\u65b9\u6cd5\u65f6\u5f02\u6b65\u7684\u3002\n        //\u5c31\u7b97\u5728\u4e0a\u4e00\u4e2ause\u51fd\u6570\u4e2d\u7684next\u52a0await\uff0c\u4e5f\u662f\u4e0d\u53ef\u4ee5\u3002\u56e0\u4e3anext\u7684await\u7b49\u5f85\u7684\u662f\u4e0b\u4e00\u4e2ause\u4e2d\u7684\u6574\u4e2apromise\uff0c\u5e76\u4e0d\u4f1a\u7b49\u5f85\u5f02\u6b65\u51fd\u6570\n       })\n    }else{\n        next()\n    }\n})\napp.listen(3000)\n")),(0,r.kt)("p",null,"\u628a\u63a5\u6536\u6570\u636e\u90e8\u5206\u51fd\u6570\u57fa\u4e8ePromise\u5c01\u88c5\u5c31\u53ef\u4ee5\u663e\u793a\u5728\u9875\u9762\u4e0a\u4e86"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\napp.use(async (ctx, next) => {\n    if (ctx.path === '/login' && ctx.method === 'GET') {\n        ctx.body = `<form action=\"/login\" method=\"post\">\n            <input type=\"text\" name=\"username\" />\n            <input type=\"text\" name=\"password\" />\n            <button>\u63d0\u4ea4</button>\n        </form>`\n    } else {\n        await next()\n    }\n})\nfunction body(ctx) {\n    return new Promise((resolve, reject) => {\n        let arr = []\n        ctx.req.on('data', function (chunk) {\n            arr.push(chunk)\n        });\n        ctx.req.on('end', function () {\n            resolve(Buffer.concat(arr))\n        })\n    })\n}\napp.use(async (ctx, next) => {\n    if (ctx.path === '/login' && ctx.method === 'POST') {\n        ctx.set('Content-Type','text/html;charset=utf-8')\n        ctx.body = await body(ctx);\n    } else {\n        next()\n    }\n})\napp.listen(3000)\n")),(0,r.kt)("p",null,"\u628a\u4e0a\u9762\u7684body\u65b9\u6cd5\u5c01\u88c5\u6210\u4e2d\u95f4\u4ef6\uff0c\u8fd9\u6837\u4e00\u6765\u540e\u9762\u6240\u6709\u7684use\u90fd\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u4e2d\u95f4\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\nconst bodyParse = require('./koa-bodparse')\napp.use(bodyParse()) \napp.use(async (ctx, next) => {\n    if (ctx.path === '/login' && ctx.method === 'GET') {\n        ctx.body = `<form action=\"/login\" method=\"post\">\n            <input type=\"text\" name=\"username\" />\n            <input type=\"text\" name=\"password\" />\n            <button>\u63d0\u4ea4</button>\n        </form>`\n    } else {\n        await next()\n    }\n})\n\napp.use(async (ctx, next) => { \n    if (ctx.path === '/login' && ctx.method === 'POST') {\n        ctx.set('Content-Type','text/html;charset=utf-8')\n        ctx.body = ctx.request.body\n    } else {\n        next()\n    }\n})\napp.listen(3000)\n")),(0,r.kt)("p",null,"\u65b0\u5efakoa-bodparse.js\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = function bodyParse() {\n    return async (ctx, next) => {\n        ctx.request.body = await body(ctx);\n        await next()\n    }\n}\nfunction body(ctx) {\n    return new Promise((resolve, reject) => {\n        let arr = []\n        ctx.req.on('data', function (chunk) {\n            arr.push(chunk)\n        });\n        ctx.req.on('end', function () {\n            //username=123&password=321\n            //\u5904\u7406\u5ba2\u6237\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6570\u636e\n            //1.\u8868\u8fbe\u683c\u5f0f form-data a=1&b=2\n            //2.json\u683c\u5f0f {a:1,b:2}\n            //3.\u6587\u4ef6\u683c\u5f0f\n            resolve(Buffer.concat(arr))\n        })\n    })\n}\n")),(0,r.kt)("p",null,"\u5904\u7406\u5ba2\u6237\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6570\u636e"),(0,r.kt)("p",null,"\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\nconst app = new Koa();\nconst bodyParse = require('./koa-bodparse');\nconst static = require('./koa-static');\nconst path = require('path')\napp.use(bodyParse())\napp.use(static(path.resolve(__dirname,'koa')))\napp.use(static(__dirname));\napp.use(async (ctx, next) => { \n    if (ctx.path === '/login' && ctx.method === 'POST') {\n        ctx.set('Content-Type','text/html;charset=utf-8')\n        ctx.body = ctx.request.body\n    } else {\n        next()\n    }\n})\napp.listen(3000)\n")),(0,r.kt)("p",null,"\u65b0\u5efakoa-static.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const path = require('path');\nconst fs = require('fs').promises;\nconst {createReadStream} = require('fs');\nconst mime = require('mime')\nmodule.exports = function koaStatic(dirname) {\n    return async (ctx, next) => {\n        let filePath = path.join(dirname, ctx.path);\n        try {\n            let statObj = await fs.stat(filePath);\n            if (statObj.isFile()) {\n                ctx.set('Content-Type',mime.getType(filePath) + ';charset=utf-8')\n                ctx.body = createReadStream(filePath)\n            } else {\n                await next()\n            }\n        } catch (e) {\n           await next()\n        }\n    }\n} \n")),(0,r.kt)("p",null,"\u4e0a\u9762\u4e24\u4e2a\u4e2d\u95f4\u4ef6 \u5728koa\u4e2d\u6709\u5bf9\u5e94\u7684\u6a21\u5757\u5305\u3002\u5206\u522b\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"koa-bodyparser"),"  ",(0,r.kt)("inlineCode",{parentName:"p"},"koa-static")),(0,r.kt)("p",null," \u63a5\u6536\u5ba2\u6237\u7aef\u6570\u636e\u7684\u5904\u7406"),(0,r.kt)("p",null,"body-parse.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"\nconst querystring = require('querystring') //koa\u81ea\u5e26\u7684\n\nmodule.exports = function bodyParse() {\n    return async (ctx, next) => {\n        ctx.request.body = await body(ctx);\n        await next()\n    }\n}\nfunction body(ctx) {\n    return new Promise((resolve, reject) => {\n        let arr = []\n        ctx.req.on('data', function (chunk) {\n            arr.push(chunk)\n        });\n        ctx.req.on('end', function () {\n            //username=123&password=321\n            //\u5904\u7406\u5ba2\u6237\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6570\u636e\n            //1.\u8868\u5355\u683c\u5f0f form-data a=1&b=2\n            //2.json\u683c\u5f0f {a:1,b:2}\n            //3.\u6587\u4ef6\u683c\u5f0f\n            //1.\u8868\u5355\u683c\u5f0f\uff1aapplication/x-www-form-urlencoded\n\n            let type = ctx.get('content-type');\n            let data = Buffer.concat(arr)\n            if (type == 'application/x-www-form-urlencoded') {\n                resolve(querystring.parse(data.toString()))\n            } else if (type == 'application/json') {\n                resolve(JSON.parse(data.toString()))\n            } else if (type == 'text/plain') {\n                resolve(data.toString())\n            } else {\n                resolve()\n            }\n        })\n    })\n}\n")),(0,r.kt)("p",null,"\u6d4b\u8bd5\u4f8b\u5b50login.html"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n</head>\n\n<body>\n    <form action="/login" method="post">\n        <input type="text" name="username" />\n        <input type="text" name="password" />\n        <button>\u63d0\u4ea4</button>\n    </form>\n    <script>\n        const xhr = new XMLHttpRequest();\n        xhr.open(\'POST\', \'/login\', true);\n        xhr.setRequestHeader(\'Content-Type\',\'application/json\')\n        xhr.onload = function () {\n            console.log(xhr.response)\n        }\n        xhr.send(JSON.stringify({a:1,b:2}))\n    <\/script>\n</body>\n\n</html>\n')),(0,r.kt)("p",null,"\u6587\u4ef6\u7c7b\u578b\u7684\u5904\u7406"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tex"},'------WebKitFormBoundarymESMEunwsrLMjta4\nContent-Disposition: form-data; name="username"\n\n123\n------WebKitFormBoundarymESMEunwsrLMjta4\nContent-Disposition: form-data; name="password"\n\n321\n------WebKitFormBoundarymESMEunwsrLMjta4\nContent-Disposition: form-data; name="avatar"; filename="a.txt"\nContent-Type: text/plain\n\nhello\n------WebKitFormBoundarymESMEunwsrLMjta4--\n')),(0,r.kt)("p",null,"koa-bodparse.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const querystring = require('querystring') //koa\u81ea\u5e26\u7684\nconst uuid = require('uuid'); //\u53ef\u4ee5\u4ea7\u751f\u552f\u4e00\u7684\u6807\u8bc6\nconst fs = require('fs');\nconst path = require('path')\nmodule.exports = function bodyParse(uploadDir) {\n    return async (ctx, next) => {\n        ctx.request.body = await body(ctx,uploadDir);\n        await next()\n    }\n}\nfunction body(ctx, uploadDir) {\n    return new Promise((resolve, reject) => {\n        let arr = []\n        ctx.req.on('data', function (chunk) {\n            arr.push(chunk)\n        });\n        ctx.req.on('end', function () {\n            //username=123&password=321\n            //\u5904\u7406\u5ba2\u6237\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6570\u636e\n            //1.\u8868\u5355\u683c\u5f0f form-data a=1&b=2\n\n            //2.json\u683c\u5f0f {a:1,b:2}\n\n            //3.\u6587\u4ef6\u683c\u5f0f\n\n\n            //1.\u8868\u5355\u683c\u5f0f\uff1aapplication/x-www-form-urlencoded\n\n            let type = ctx.get('content-type');\n            let data = Buffer.concat(arr)\n            if (type == 'application/x-www-form-urlencoded') {\n                resolve(querystring.parse(data.toString()))\n            } else if (type == 'application/json') {\n                resolve(JSON.parse(data.toString()))\n            } else if (type == 'text/plain') {\n                resolve(data.toString())\n                //\u6b64\u5904\u5f53\u4e3a\u6587\u4ef6\u7c7b\u578b\u662f \u4e0d\u7528\u4f7f\u7528\u8fd9\u4e2a\u6765\u5224\u65ad\u800c\u662f\u4f7f\u7528starstwith\uff0c\u56e0\u4e3a\u8bf7\u6c42\u5934\u4e3amultipart/form-data; boundary=----WebKitFormBoundaryBRPmZc6dYljFpCmo\n            } else if (type.startsWith('multipart/form-data')) {\n                // console.log(data.toString())\u6b64\u5904\u4e0d\u80fd\u8f6c\u6210string\u56e0\u4e3a\u6587\u4ef6\u7c7b\u578b\u4f20\u9012\u7684\u6570\u636e\u662f\u4e8c\u8fdb\u5236\u7684\uff0c\u8f6cstring\u65f6\u4f1a\u4e71\u7801\n\n                //\u6839\u636e\u5206\u9694\u7b26\u8fdb\u884c\u6570\u636e\u7684\u5206\u5272\n                let boundary = '--' + type.split('=')[1];\n                let lines = data.split(boundary)\n                lines = lines.slice(1, -1);\n                console.log(lines)\n                let resultObj = {};\n                lines.forEach(line => {\n                    let [head, body] = line.split('\\r\\n\\r\\n')\n                    if (head) {\n                        let key = head.toString().match(/name=\"(.+?)\"/)[1]\n                        if (!head.includes('filename')) {\n                            resultObj[key] = body.slice(0, -2).toString();\n                        } else {\n                            //\u6587\u4ef6\u4e0a\u4f20\n                            let originalName = head.toString().match(/filename=\"(.+?)\"/)[1]\n                            let filename = uuid.v4(); //\u53ef\u4ee5\u4ea7\u751f\u552f\u4e00\u7684\u6587\u4ef6\u540d\n                            console.log('-----------',filename)\n                            //\u83b7\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\n                            let content = line.slice(head.length + 4 - 2);\n                            fs.writeFileSync(path.join(uploadDir,filename),content)\n                            resultObj[key] = resultObj[key] || [];\n                            resultObj[key].push({\n                                size:content.length,\n                                name:originalName,\n                                filename\n                            })\n                        }\n                    }\n                });\n\n                resolve(resultObj)\n            } else {\n                resolve()\n            }\n\n            //2.ajax\u683c\u5f0f\n\n        })\n    })\n}\n//\u62d3\u5c55buffer\u4e0a\u7684\u5206\u5272\u65b9\u6cd5 Buffer.indexOf('\u5b57\u7b26\u4e32')\nBuffer.prototype.split = function (boundary) {\n    let arr = [];\n    let offset = 0;\n    let currentPosition = 0;\n    while (-1 != (currentPosition = this.indexOf(boundary, offset))) {\n        arr.push(this.slice(offset, currentPosition))\n        offset = currentPosition + boundary.length;\n    }\n    arr.push(this.slice(offset))\n    return arr;\n}\n// console.log(Buffer.from('111111&11111&111&111').split('&'))\n")),(0,r.kt)("p",null,"body.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//\u670d\u52a1\u7aef\u6709\u53ef\u80fd\u4ece\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u7528\u6237\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u670d\u52a1\u7aef\u9700\u8981\u8fdb\u884c\u5c06\u8bf6\u6536\u6570\u636e\u5e76\u54cd\u5e94\uff08\u4f8b\u5982Ajax\uff09\nconst Koa = require('koa');\nconst app = new Koa();\nconst bodyParse = require('./koa-bodparse');\nconst static = require('./koa-static');\nconst path = require('path')\n//\u5047\u8bbe\uff1a\n//1.\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee/login\u4e14\u4e3aget\u65f6\uff0c\u670d\u52a1\u7aef\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u767b\u5f55\u9875\n//\u6ce8\u91ca\uff1a\u8868\u5355\u63d0\u4ea4\u6ca1\u6709\u8de8\u57df\u7684\u95ee\u9898\uff0c\u8de8\u57df\u662f\u6d4f\u89c8\u5668\u672c\u8eab\u7684\u95ee\u9898;\napp.use(bodyParse(path.resolve(__dirname,'upload'))) //\u6240\u6709\u7684\u63d2\u4ef6\u90fd\u662f\u4e00\u4e2a\u51fd\u6570\napp.use(static(path.resolve(__dirname,'koa')))\napp.use(static(__dirname));\n//2.\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee/login\u4e14\u4e3apost\u65f6\uff0c\u670d\u52a1\u7aef\u9700\u8981\u505a\u767b\u5f55\u64cd\u4f5c\napp.use(async (ctx, next) => { \n    if (ctx.path === '/login' && ctx.method === 'POST') {\n        ctx.set('Content-Type','text/html;charset=utf-8')\n        ctx.body = ctx.request.body\n    } else {\n        next()\n    }\n})\n\napp.listen(3000)\n")),(0,r.kt)("p",null,"\u4f7f\u7528\u9875\u9762login.html"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n</head>\n<body>\n    <form action="/login" method="post" enctype="multipart/form-data">\n        \x3c!-- enctype="application/x-www-form-urlencoded" \u4ee5\u524d\u662f\u8fd9\u79cd\u5b58\u7684\u662f\u8868\u5355\u683c\u5f0f\u7684a=1&b=2--\x3e\n        \x3c!-- \u5f53\u4e3a\u4e0a\u4f20\u6587\u4ef6\u65f6\u5219\u9700\u8981 enctype="multipart/form-data"\u89c4\u5b9a\u7684 --\x3e\n        <input type="text" name="username" />\n        <input type="text" name="password" />\n        <input type="file" name="avatar" multiple>\n        <button>\u63d0\u4ea4</button>\n    </form>\n    <script>\n        const xhr = new XMLHttpRequest();\n        xhr.open(\'POST\', \'/login\', true);\n        xhr.setRequestHeader(\'Content-Type\',\'application/json\')\n        xhr.onload = function () {\n            console.log(xhr.response)\n        }\n        xhr.send(JSON.stringify({a:1,b:2}))\n    <\/script>\n</body>\n</html>\n')),(0,r.kt)("h3",{id:"4koa\u7684\u5e94\u7528"},"4.Koa\u7684\u5e94\u7528"),(0,r.kt)("p",null,"\u5165\u53e3\u6587\u4ef6 - index.js"),(0,r.kt)("p",null,"\u6e32\u67d3\u6a21\u677f - views\u6587\u4ef6\u5939"),(0,r.kt)("p",null,"\u5b58\u653e\u8def\u7531 - routes\u6587\u4ef6\u5939"),(0,r.kt)("p",null,"\u8def\u7531\u5bf9\u5e94\u7684\u5904\u7406\u903b\u8f91 -controller"),(0,r.kt)("p",null,"\u6570\u636e\u5904\u7406 - model"),(0,r.kt)("p",null,"\u516c\u5171\u6587\u4ef6 - public"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//views \u5173\u4e8e\u6a21\u7248\u5f15\u64ce\u7684\u6587\u4ef6\n//routes \u8def\u7531 \u53ef\u4ee5\u4f7f\u7528Koa-router \u6839\u636e\u4e0d\u540c\u7684\u529f\u80fd\u6765\u5212\u5206\u8def\u7531\n//model \u5b58\u653e\u6570\u636e\u5e93\u76f8\u5173\u7684\n//controller \u63a7\u5236\u5668\uff1a\u6bcf\u4e00\u4e2a\u8def\u7531\u90fd\u5bf9\u5e94\u4e00\u4e2a\u63a7\u5236\u5668\n//services \u63d0\u4f9b\u670d\u52a1\uff0c\u63a7\u5236\u5668\u4e2d\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u4e2d\u7684\u6570\u636e\n\n//\u535a\u5ba2\u7cfb\u7edf \u6587\u7ae0\u7ba1\u7406\u548c\u7528\u6237\u7ba1\u7406\n\nconst Koa = require('koa');\nconst app = new Koa();\nconst bodyparser = require('koa-bodyparser');\nconst static = require('koa-static');\nconst views = require('koa-views')\nconst path  = require('path')\n\nconst router = require('./routes/index');//\u83b7\u5f97\u8def\u7531\u7cfb\u7edf\n\n// console.log(router)\n//\u5148\u89e3\u6790\u518d\u8def\u7531\napp.use(bodyparser());\napp.use(views(path.resolve(__dirname,'views'),{\n    map:{\n        'html':'ejs'\n    }\n}))\napp.use(static(path.resolve(__dirname,'public')));\n//\u6ce8\u518c\u8def\u7531\napp.use(router());\n//\u6a21\u677f\u5f15\u64ce \n//npm install ejs koa-views koa-static koa-bodyparser\n\napp.listen(3000)\n")),(0,r.kt)("p",null,"controller"),(0,r.kt)("p",null,"articleController.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"class ArticleController{\n    add(ctx,next){\n        ctx.body = '\u6587\u7ae0\u6dfb\u52a0'\n    }\n    list(ctx,next){\n        ctx.body = '\u6587\u7ae0\u5217\u8868'\n    }\n}\n\nmodule.exports = ArticleController;\n")),(0,r.kt)("p",null,"userController.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"class UserController{\n    async add(ctx,next){\n        // ctx.statusCode = 200;\n        ctx.body = '\u7528\u6237\u6dfb\u52a0';\n        await ctx.render('a.html',{name:100})\n    }\n    list(ctx,next){\n        ctx.body = '\u7528\u6237\u5217\u8868'\n    }\n}\n\nmodule.exports = UserController;\n")),(0,r.kt)("p",null,"public - index.html"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n</head>\n<body>\n    hello\n</body>\n</html>\n')),(0,r.kt)("p",null,"routes"),(0,r.kt)("p",null,"articleRouter.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//1.\u5fc3\u95f4\u5bf9\u5e94\u6a21\u5757\u7684\u8def\u7531\uff1a\u6dfb\u52a0\u6587\u7ae0 \u6587\u7ae0\u67e5\u8be2\n//2.\u5f15\u5165\u5bf9\u5e94\u7684\u63a7\u5236\u5668\nconst ArticleController = require('../controller/articleController');\nlet Router = require('koa-router');\nlet articleCtrl = new ArticleController();\n//\u5212\u5206\u524d\u7f00\uff0c\u50cf\u6587\u7ae0\u90fd\u662farticle\u5f00\u5934 article/add article/remove\nconst router = new Router({prefix:'/article'});\nconsole.log('-----',articleCtrl)\nrouter.get('/add',articleCtrl.add);\nrouter.get('/list',articleCtrl.list); //\u6bcf\u4e00\u4e2a\u8def\u7531\u5bf9\u5e94\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u6240\u4ee5\u9700\u8981\u5728controller\u6587\u4ef6\u5939\u4e2d\u5fc3\u95f4\u5bf9\u5e94\u7684\u63a7\u5236\u5668\n\nmodule.exports = router\n")),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//\u6574\u5408\u6a21\u5757\nlet articleRouter = require('./articleRouter');\nlet userRouter = require('./userRouter');\n\nlet combineRouters = require('koa-combine-routers');\nmodule.exports = combineRouters(articleRouter,userRouter)\n")),(0,r.kt)("p",null,"userRouter.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//1.\u5fc3\u95f4\u5bf9\u5e94\u6a21\u5757\u7684\u8def\u7531\uff1a\n//2.\u5f15\u5165\u5bf9\u5e94\u7684\u63a7\u5236\u5668\n\nconst UserController = require('../controller/userController');\nlet Router = require('koa-router');\nlet userCtrl = new UserController();\nconst router = new Router({prefix:'/user'});\n\nrouter.get('/add',userCtrl.add);\nrouter.get('/list',userCtrl.list);\n\nmodule.exports = router\n")),(0,r.kt)("p",null,"views - a.html"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n</head>\n<body>\n    <%=name%>\n</body>\n</html>\n')))}d.isMDXComponent=!0}}]);