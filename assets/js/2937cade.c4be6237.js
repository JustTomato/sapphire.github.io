"use strict";(self.webpackChunksapphire=self.webpackChunksapphire||[]).push([[471],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),m=i,k=c["".concat(s,".").concat(m)]||c[m]||d[m]||r;return t?a.createElement(k,o(o({ref:n},u),{},{components:t})):a.createElement(k,o({ref:n},u))}));function k(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},4826:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=t(7462),i=(t(7294),t(3905));const r={},o="\u5256\u6790\u6e90\u7801Vue\u9879\u76ee\u7ed3\u6784 (\u4e00)",l={unversionedId:"vue/\u6e90\u7801\u4ecb\u7ecd",id:"vue/\u6e90\u7801\u4ecb\u7ecd",title:"\u5256\u6790\u6e90\u7801Vue\u9879\u76ee\u7ed3\u6784 (\u4e00)",description:"\u4e00.\u638c\u63e1\u6e90\u7801\u76ee\u5f55\u7684\u7ed3\u6784",source:"@site/docs/vue/\u6e90\u7801\u4ecb\u7ecd.md",sourceDirName:"vue",slug:"/vue/\u6e90\u7801\u4ecb\u7ecd",permalink:"/sapphire.github.io/docs/vue/\u6e90\u7801\u4ecb\u7ecd",draft:!1,tags:[],version:"current",frontMatter:{}},s={},p=[{value:"\u4e00.\u638c\u63e1\u6e90\u7801\u76ee\u5f55\u7684\u7ed3\u6784",id:"\u4e00\u638c\u63e1\u6e90\u7801\u76ee\u5f55\u7684\u7ed3\u6784",level:2},{value:"1.\u4ecb\u7ecdVue\u6574\u4e2a\u76ee\u5f55\u7ed3\u6784",id:"1\u4ecb\u7ecdvue\u6574\u4e2a\u76ee\u5f55\u7ed3\u6784",level:3},{value:"2.\u4ecb\u7ecdVue\u6e90\u7801\u7684\u76ee\u5f55\u7ed3\u6784",id:"2\u4ecb\u7ecdvue\u6e90\u7801\u7684\u76ee\u5f55\u7ed3\u6784",level:3},{value:"\u4e8c.\u6253\u5305\u6d41\u7a0b",id:"\u4e8c\u6253\u5305\u6d41\u7a0b",level:2},{value:"\u4e09.\u5165\u53e3\u5206\u6790",id:"\u4e09\u5165\u53e3\u5206\u6790",level:2},{value:"\u56db.Vue\u7684\u6784\u9020\u51fd\u6570",id:"\u56dbvue\u7684\u6784\u9020\u51fd\u6570",level:2},{value:"\u4e00.\u5256\u6790\u5168\u5c40Api",id:"\u4e00\u5256\u6790\u5168\u5c40api",level:2},{value:"1.Vue.util",id:"1vueutil",level:3},{value:"2.Vue.set / Vue.delete",id:"2vueset--vuedelete",level:3},{value:"3.Vue.nextTick",id:"3vuenexttick",level:3},{value:"4.Vue.observable",id:"4vueobservable",level:3},{value:"5.Vue.options",id:"5vueoptions",level:3},{value:"6.Vue.use",id:"6vueuse",level:3},{value:"7.Vue.mixin",id:"7vuemixin",level:3},{value:"8.Vue.extend",id:"8vueextend",level:3},{value:"9.\u7ec4\u4ef6\u3001\u6307\u4ee4\u3001\u8fc7\u6ee4\u5668",id:"9\u7ec4\u4ef6\u6307\u4ee4\u8fc7\u6ee4\u5668",level:3},{value:"\u4e8c.\u5256\u6790Vue\u7684\u521d\u59cb\u5316\u8fc7\u7a0b",id:"\u4e8c\u5256\u6790vue\u7684\u521d\u59cb\u5316\u8fc7\u7a0b",level:2},{value:"1.Vue\u7684\u521d\u59cb\u5316",id:"1vue\u7684\u521d\u59cb\u5316",level:3},{value:"2._init\u65b9\u6cd5\u4e2d\u7684\u521d\u59cb\u5316",id:"2_init\u65b9\u6cd5\u4e2d\u7684\u521d\u59cb\u5316",level:3},{value:"3.\u6302\u8f7d\u6d41\u7a0b",id:"3\u6302\u8f7d\u6d41\u7a0b",level:3},{value:"\u4e00.\u6570\u636e\u52ab\u6301",id:"\u4e00\u6570\u636e\u52ab\u6301",level:2},{value:"1.\u6570\u636e\u7684\u521d\u59cb\u5316",id:"1\u6570\u636e\u7684\u521d\u59cb\u5316",level:3},{value:"2.\u89c2\u6d4b\u6570\u636e",id:"2\u89c2\u6d4b\u6570\u636e",level:3},{value:"3.\u5bf9\u8c61\u7684\u89c2\u6d4b",id:"3\u5bf9\u8c61\u7684\u89c2\u6d4b",level:3},{value:"4.\u6570\u7ec4\u7684\u89c2\u6d4b",id:"4\u6570\u7ec4\u7684\u89c2\u6d4b",level:3},{value:"\u4e8c.\u4f9d\u8d56\u6536\u96c6",id:"\u4e8c\u4f9d\u8d56\u6536\u96c6",level:2},{value:"2.1 \u5bf9\u8c61\u4f9d\u8d56\u6536\u96c6",id:"21-\u5bf9\u8c61\u4f9d\u8d56\u6536\u96c6",level:3},{value:"2.2 \u6570\u7ec4\u7684\u4f9d\u8d56\u6536\u96c6",id:"22-\u6570\u7ec4\u7684\u4f9d\u8d56\u6536\u96c6",level:3},{value:"\u4e09.\u5f02\u6b65\u66f4\u65b0",id:"\u4e09\u5f02\u6b65\u66f4\u65b0",level:2}],u={toc:p},c="wrapper";function d(e){let{components:n,...r}=e;return(0,i.kt)(c,(0,a.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u5256\u6790\u6e90\u7801vue\u9879\u76ee\u7ed3\u6784-\u4e00"},"\u5256\u6790\u6e90\u7801Vue\u9879\u76ee\u7ed3\u6784 (\u4e00)"),(0,i.kt)("h2",{id:"\u4e00\u638c\u63e1\u6e90\u7801\u76ee\u5f55\u7684\u7ed3\u6784"},"\u4e00.\u638c\u63e1\u6e90\u7801\u76ee\u5f55\u7684\u7ed3\u6784"),(0,i.kt)("h3",{id:"1\u4ecb\u7ecdvue\u6574\u4e2a\u76ee\u5f55\u7ed3\u6784"},"1.\u4ecb\u7ecdVue\u6574\u4e2a\u76ee\u5f55\u7ed3\u6784"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},".circleci \u6301\u7eed\u96c6\u6210"),(0,i.kt)("li",{parentName:"ul"},"benchmarks \u6027\u80fd\u8bc4\u6d4b"),(0,i.kt)("li",{parentName:"ul"},"dist \u8f93\u51fa\u76ee\u5f55"),(0,i.kt)("li",{parentName:"ul"},"examples \u6848\u4f8b"),(0,i.kt)("li",{parentName:"ul"},"flow flow\u58f0\u660e\u6587\u4ef6"),(0,i.kt)("li",{parentName:"ul"},"packages vue\u4e2d\u7684\u5305"),(0,i.kt)("li",{parentName:"ul"},"scripts \u5de5\u7a0b\u5316"),(0,i.kt)("li",{parentName:"ul"},"src \u6e90\u7801\u76ee\u5f55"),(0,i.kt)("li",{parentName:"ul"},"test \u6d4b\u8bd5\u76f8\u5173"),(0,i.kt)("li",{parentName:"ul"},"types ts\u58f0\u660e\u6587\u4ef6")),(0,i.kt)("h3",{id:"2\u4ecb\u7ecdvue\u6e90\u7801\u7684\u76ee\u5f55\u7ed3\u6784"},"2.\u4ecb\u7ecdVue\u6e90\u7801\u7684\u76ee\u5f55\u7ed3\u6784"),(0,i.kt)("p",null,"\u4e3a\u4e86\u76f4\u89c2\u7684\u67e5\u770b\u76ee\u5f55\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7",(0,i.kt)("inlineCode",{parentName:"p"},"tree"),"\u547d\u4ee4\u6765\u67e5\u770b",(0,i.kt)("inlineCode",{parentName:"p"},"src"),"\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5939\u3002\u5148\u5927\u6982\u5bf9\u6e90\u7801\u7684\u7ed3\u6784\u6709\u4e00\u4e2a\u5927\u4f53\u7684\u8ba4\u8bc6\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"\u251c\u2500compiler       # \u7f16\u8bd1\u7684\u76f8\u5173\u903b\u8f91\n\u2502  \u251c\u2500codegen\n\u2502  \u251c\u2500directives\n\u2502  \u2514\u2500parser\n\u251c\u2500core           # vue\u6838\u5fc3\u4ee3\u7801\n\u2502  \u251c\u2500components  # vue\u4e2d\u7684\u5185\u7f6e\u7ec4\u4ef6 keep-alive\n\u2502  \u251c\u2500global-api  # vue\u4e2d\u7684\u5168\u5c40api\n\u2502  \u251c\u2500instance    # vue\u4e2d\u7684\u6838\u5fc3\u903b\u8f91\n\u2502  \u251c\u2500observer    # vue\u4e2d\u7684\u54cd\u5e94\u5f0f\u539f\u7406\n\u2502  \u251c\u2500util        \n\u2502  \u2514\u2500vdom        # vue\u4e2d\u7684\u865a\u62dfdom\u6a21\u5757\n\u251c\u2500platforms      # \u5e73\u53f0\u4ee3\u7801\n\u2502  \u251c\u2500web         # web\u903b\u8f91 - vue\n\u2502  \u2502  \u251c\u2500compiler\n\u2502  \u2502  \u251c\u2500runtime\n\u2502  \u2502  \u251c\u2500server\n\u2502  \u2502  \u2514\u2500util\n\u2502  \u2514\u2500weex        # weex\u903b\u8f91 - app\n\u2502      \u251c\u2500compiler\n\u2502      \u251c\u2500runtime\n\u2502      \u2514\u2500util\n\u251c\u2500server         # \u670d\u52a1\u7aef\u6e32\u67d3\u6a21\u5757\n\u251c\u2500sfc            # \u7528\u4e8e\u7f16\u8bd1.vue\u6587\u4ef6\n\u2514\u2500shared         # \u5171\u4eab\u7684\u65b9\u6cd5\u548c\u5e38\u91cf\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5230\u8fd9\u91cc\u53ef\u80fd\u4f60\u53ea\u80fd\u770b\u7684\u61c2\u6587\u4ef6\u5939\u7684\u7ec4\u6210\uff0c\u8fd8\u65e0\u6cd5\u77e5\u9053\u4ee3\u7801\u662f\u5982\u4f55\u8fd0\u884c\u7684\uff0cso~ \u4f60\u9700\u8981\u901a\u8fc7",(0,i.kt)("inlineCode",{parentName:"p"},"package.json"),"\u6765\u67e5\u627e\u4ee3\u7801\u662f\u5982\u4f55\u88ab\u6253\u5305\u7684!")),(0,i.kt)("h2",{id:"\u4e8c\u6253\u5305\u6d41\u7a0b"},"\u4e8c.\u6253\u5305\u6d41\u7a0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'"build": "node scripts/build.js",  \n"build:ssr": "npm run build -- web-runtime-cjs,web-server-renderer",\n"build:weex": "npm run build -- weex",\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u6838\u5fc3\u662f\u4f7f\u7528node\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"scripts/build.js"),",\u901a\u8fc7\u4f20\u9012\u53c2\u6570\u6765\u5b9e\u73b0\u4e0d\u540c\u7684\u6253\u5305\u7ed3\u679c\uff0c\u8fd9\u91cc\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"--"),"\u4ee3\u8868\u540e\u9762\u7684\u5185\u5bb9\u662f\u53c2\u6570\u3002")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"build.js"))),(0,i.kt)("p",null,"\u65e2\u7136\u662f\u6253\u5305\uff0c\u90a3\u6211\u4eec\u80af\u5b9a\u8981\u627e\u5230\u6253\u5305\u7684\u5165\u53e3\u70b9,\u6240\u4ee5\u8fd9\u91cc\u7684\u5173\u952e\u5c31\u662f\u67e5\u627e",(0,i.kt)("strong",{parentName:"p"},"\u6253\u5305\u7684\u5165\u53e3"),"!"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// 1.\u83b7\u53d6\u4e0d\u540c\u7684\u6253\u5305\u7684\u914d\u7f6e \nlet builds = require('./config').getAllBuilds()\n\n// 2.\u6839\u636e\u6267\u884c\u6253\u5305\u65f6\u7684\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4\nif (process.argv[2]) {\n  const filters = process.argv[2].split(',')\n  builds = builds.filter(b => {\n    return filters.some(f => b.output.file.indexOf(f) > -1 || b._name.indexOf(f) > -1)\n  })\n} else {\n  // \u9ed8\u8ba4\u4e0d\u6253\u5305weex\u76f8\u5173\u4ee3\u7801\n  builds = builds.filter(b => {\n    return b.output.file.indexOf('weex') === -1\n  })\n}\n// 3.\u8fdb\u884c\u6253\u5305\nbuild(builds)\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u4e0d\u540c\u7684\u6253\u5305\u914d\u7f6e\u6307\u7684\u662f:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"web")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"weex")," \u4e0d\u540c\u7684\u5e73\u53f0"),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u6211\u4eec\u4e0d\u5173\u6ce8",(0,i.kt)("inlineCode",{parentName:"p"},"weex"),",",(0,i.kt)("inlineCode",{parentName:"p"},"web"),"\u6307\u4ee3\u7684\u5c31\u662f\u6211\u4eec\u5e38\u7528\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"vue")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Runtime only")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"Runtime + compiler")," \u662f\u5426\u5e26\u7f16\u8bd1\u6a21\u5757"),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},"\u5e26\u6709",(0,i.kt)("inlineCode",{parentName:"p"},"compiler"),"\u7684\u4f1a\u5c06\u6a21\u677f\u8f6c\u5316\u6210",(0,i.kt)("inlineCode",{parentName:"p"},"render"),"\u51fd\u6570"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"CommonJS")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"es")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"umd")," \u6253\u5305\u51fa\u4e0d\u540c\u6a21\u5757\u89c4\u8303"),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("inlineCode",{parentName:"p"},"umd"),"\u6a21\u5757\u662f\u6574\u5408\u4e86",(0,i.kt)("inlineCode",{parentName:"p"},"CommonJS\u548cAMD"),"\u4e24\u4e2a\u6a21\u5757\u5b9a\u4e49\u89c4\u8303\u7684\u65b9\u6cd5,\u5f53\u4e0d\u652f\u6301\u65f6\u4e24\u79cd\u6a21\u5757\u65f6\u4f1a\u5c06\u5176\u6dfb\u52a0\u5230\u5168\u5c40\u53d8\u91cf\u4e2d")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u6253\u5305\u5165\u53e3")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"src/platforms/web/entry-runtime.js\nsrc/platforms/web/entry-runtime-with-compiler.js\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6253\u5305\u7684\u914d\u7f6e\u627e\u5230\u6211\u4eec\u9700\u8981\u7684\u5165\u53e3\uff0c\u8fd9\u4e24\u4e2a\u533a\u522b\u5728\u4e8e\u662f\u5426\u6db5\u76d6",(0,i.kt)("inlineCode",{parentName:"p"},"compiler"),"\u903b\u8f91\uff0c\u6211\u4eec\u5728\u5f00\u53d1\u65f6\u4e00\u822c\u4f7f\u7528\u7684\u662f",(0,i.kt)("inlineCode",{parentName:"p"},"entry-runtime"),",\u53ef\u4ee5\u51cf\u5c0f",(0,i.kt)("inlineCode",{parentName:"p"},"vue"),"\u7684\u4f53\u79ef\uff0c\u4f46\u662f\u540c\u6837\u5728\u5f00\u53d1\u65f6\u4e5f\u4e0d\u80fd\u518d\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"template"),",",(0,i.kt)("inlineCode",{parentName:"p"},".vue"),"\u6587\u4ef6\u4e2d\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"template"),"\u662f\u901a\u8fc7",(0,i.kt)("inlineCode",{parentName:"p"},"vue-loader"),"\u6765\u8fdb\u884c\u7f16\u8bd1\u7684\uff0c\u548c\u6211\u4eec\u6240\u8bf4\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"compiler"),"\u65e0\u5173\u54c8\u3002")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"new Vue({\n    template:`<div></div>`\n})\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8fd9\u6837\u7684template\u5fc5\u987b\u8981\u4f7f\u7528\u5e26compiler\u7684\u5165\u53e3\u624d\u80fd\u8fdb\u884c\u6a21\u677f\u7684\u89e3\u6790")),(0,i.kt)("h2",{id:"\u4e09\u5165\u53e3\u5206\u6790"},"\u4e09.\u5165\u53e3\u5206\u6790"),(0,i.kt)("p",null,"\u8fd9\u91cc\u4e3a\u4e86\u5256\u6790",(0,i.kt)("inlineCode",{parentName:"p"},"vue"),"\u5b8c\u6574\u7684\u4ee3\u7801,\u6211\u4eec\u5c31\u6765\u5206\u6790\u5e26\u6709",(0,i.kt)("inlineCode",{parentName:"p"},"compiler"),"\u7684\u6587\u4ef6\u3002"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u6211\u4eec\u89c2\u5bdf\u8fd9\u4e24\u4e2a\u5165\u53e3\u7684\u6587\u4ef6\u4e0d\u96be\u53d1\u73b0\u4ed6\u4eec\u90fd\u5f15\u5165\u4e86",(0,i.kt)("inlineCode",{parentName:"p"},"runtime/index.js"))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"entry-runtime-with-compiler.js"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import Vue from './runtime/index' //    1.\u5f15\u5165\u8fd0\u884c\u65f6\u4ee3\u7801\nconst mount = Vue.prototype.$mount; //  2.\u83b7\u53d6runtime\u4e2d\u7684$mount\u65b9\u6cd5\nVue.prototype.$mount = function (el,hydrating) { // 3. \u91cd\u5199$mount\u65b9\u6cd5\n  el = el && query(el)\n  const options = this.$options\n  if (!options.render) { // 4.\u6ca1\u6709render\u65b9\u6cd5\u5c31\u8fdb\u884c\u7f16\u8bd1\u64cd\u4f5c\n    let template = options.template\n    if(template){ // 5.\u5c06\u6a21\u677f\u7f16\u8bd1\u6210\u51fd\u6570\n        const { render, staticRenderFns } = compileToFunctions(template, {\n            outputSourceRange: process.env.NODE_ENV !== 'production',\n            shouldDecodeNewlines,\n            shouldDecodeNewlinesForHref,\n            delimiters: options.delimiters,\n            comments: options.comments\n        }, this)\n        options.render = render // 6.\u5c06render\u51fd\u6570\u653e\u5230options\u4e2d\n    }\n    // todo...\n  }\n  return mount.call(this, el, hydrating) // 7.\u8fdb\u884c\u6302\u8f7d\u64cd\u4f5c\n}\nexport default Vue\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5e26\u6709",(0,i.kt)("inlineCode",{parentName:"p"},"compiler"),"\u7684\u6587\u4ef6\u4ec5\u4ec5\u662f\u5bf9",(0,i.kt)("inlineCode",{parentName:"p"},"$mount"),"\u65b9\u6cd5\u8fdb\u884c\u4e86\u91cd\u5199,\u589e\u6dfb\u4e86\u5c06",(0,i.kt)("inlineCode",{parentName:"p"},"template"),"\u53d8\u6210",(0,i.kt)("inlineCode",{parentName:"p"},"render"),"\u51fd\u6570\u7684\u529f\u80fd")),(0,i.kt)("h2",{id:"\u56dbvue\u7684\u6784\u9020\u51fd\u6570"},"\u56db.Vue\u7684\u6784\u9020\u51fd\u6570"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"img",src:t(602).Z,width:"757",height:"637"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"instance/index.js")," \u771f\u6b63\u7684Vue\u7684\u6784\u9020\u51fd\u6570,\u5e76\u5728Vue\u7684\u539f\u578b\u4e0a\u6269\u5c55\u65b9\u6cd5"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"core/index.js")," \u589e\u52a0\u5168\u5c40",(0,i.kt)("inlineCode",{parentName:"li"},"API"),"\u65b9\u6cd5"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"runtime/index.js")," \u6269\u5c55",(0,i.kt)("inlineCode",{parentName:"li"},"$mount"),"\u65b9\u6cd5\u53ca\u5e73\u53f0\u5bf9\u5e94\u7684\u4ee3\u7801")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5230\u6b64\u4e3a\u6b62\u6211\u4eec\u5c31\u5c06\u6587\u4ef6\u5173\u8054\u8d77\u6765\u4e86\u3002\u4e0b\u4e00\u6b65\u6211\u4eec\u5c31\u5f00\u59cb\u6765\u5206\u6790\u7ec6\u8282\u5427!")),(0,i.kt)("h1",{id:"\u5256\u6790\u6e90\u7801\u5168\u5c40api--\u6267\u884c\u6d41\u7a0b-\u4e8c"},"\u5256\u6790\u6e90\u7801\u5168\u5c40API & \u6267\u884c\u6d41\u7a0b (\u4e8c)"),(0,i.kt)("h2",{id:"\u4e00\u5256\u6790\u5168\u5c40api"},"\u4e00.\u5256\u6790\u5168\u5c40Api"),(0,i.kt)("p",null,"\u8fd9\u91cc\u9700\u8981\u5927\u5bb6\u638c\u63e1Vue\u7684\u57fa\u672c\u5e94\u7528\uff0c\u5bf9Vue\u7684\u5168\u5c40API\u6709\u4e00\u5b9a\u7684\u638c\u63e1"),(0,i.kt)("h3",{id:"1vueutil"},"1.Vue.util"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// exposed util methods.\n// NOTE: these are not considered part of the public API - avoid relying on\n// them unless you are aware of the risk.\nVue.util = {\n    warn,\n    extend,\n    mergeOptions,\n    defineReactive\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u66b4\u9732\u7684\u5de5\u5177\u65b9\u6cd5\u3002\u8fd9\u4e9b\u65b9\u6cd5\u4e0d\u88ab\u89c6\u4e3a\u516c\u5171API\u7684\u4e00\u90e8\u5206\uff0c\u9664\u975e\u4f60\u77e5\u9053\u91cc\u9762\u7684\u98ce\u9669\uff0c\u5426\u5219\u907f\u514d\u4f7f\u7528\u3002\uff08\u8fd9\u4e2autil\u662fVue\u5185\u90e8\u7684\u5de5\u5177\u65b9\u6cd5\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u52a8\uff09\uff0c\u4f8b\u5982\uff1a\u5728Vue.router\u4e2d\u5c31\u4f7f\u7528\u4e86\u8fd9\u4e2a\u5de5\u5177\u65b9\u6cd5")),(0,i.kt)("h3",{id:"2vueset--vuedelete"},"2.Vue.set / Vue.delete"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"set"),"\u65b9\u6cd5\u65b0\u589e\u54cd\u5e94\u5f0f\u6570\u636e"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function set (target: Array<any> | Object, key: any, val: any): any {\n  // 1.\u662f\u5f00\u53d1\u73af\u5883 target \u6ca1\u5b9a\u4e49\u6216\u8005\u662f\u57fa\u7840\u7c7b\u578b\u5219\u62a5\u9519\n  if (process.env.NODE_ENV !== 'production' &&\n    (isUndef(target) || isPrimitive(target))\n  ) {\n    warn(`Cannot set reactive property on undefined, null, or primitive value: ${(target: any)}`)\n  }\n  // 2.\u5982\u679c\u662f\u6570\u7ec4 Vue.set(array,1,100); \u8c03\u7528\u6211\u4eec\u91cd\u5199\u7684splice\u65b9\u6cd5 (\u8fd9\u6837\u53ef\u4ee5\u66f4\u65b0\u89c6\u56fe)\n  if (Array.isArray(target) && isValidArrayIndex(key)) {\n    target.length = Math.max(target.length, key)\n    target.splice(key, 1, val)\n    return val\n  }\n  // 3.\u5982\u679c\u662f\u5bf9\u8c61\u672c\u8eab\u7684\u5c5e\u6027\uff0c\u5219\u76f4\u63a5\u6dfb\u52a0\u5373\u53ef\n  if (key in target && !(key in Object.prototype)) {\n    target[key] = val\n    return val\n  }\n  const ob = (target: any).__ob__\n  // 4.\u5982\u679c\u662fVue\u5b9e\u4f8b \u6216 \u6839\u6570\u636edata\u65f6 \u62a5\u9519\n  if (target._isVue || (ob && ob.vmCount)) {\n    process.env.NODE_ENV !== 'production' && warn(\n      'Avoid adding reactive properties to a Vue instance or its root $data ' +\n      'at runtime - declare it upfront in the data option.'\n    )\n    return val\n  }\n  // 5.\u5982\u679c\u4e0d\u662f\u54cd\u5e94\u5f0f\u7684\u4e5f\u4e0d\u9700\u8981\u5c06\u5176\u5b9a\u4e49\u6210\u54cd\u5e94\u5f0f\u5c5e\u6027\n  if (!ob) {\n    target[key] = val\n    return val\n  }\n  // 6.\u5c06\u5c5e\u6027\u5b9a\u4e49\u6210\u54cd\u5e94\u5f0f\u7684\n  defineReactive(ob.value, key, val)\n  ob.dep.notify() // 7.\u901a\u77e5\u89c6\u56fe\u66f4\u65b0\n  return val\n}\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function del (target: Array<any> | Object, key: any) {\n  if (process.env.NODE_ENV !== 'production' &&\n    (isUndef(target) || isPrimitive(target))\n  ) {\n    warn(`Cannot delete reactive property on undefined, null, or primitive value: ${(target: any)}`)\n  }\n  // 1.\u5982\u679c\u662f\u6570\u7ec4\u4f9d\u65e7\u8c03\u7528splice\u65b9\u6cd5\n  if (Array.isArray(target) && isValidArrayIndex(key)) {\n    target.splice(key, 1)\n    return\n  }\n  const ob = (target: any).__ob__\n  if (target._isVue || (ob && ob.vmCount)) {\n    process.env.NODE_ENV !== 'production' && warn(\n      'Avoid deleting properties on a Vue instance or its root $data ' +\n      '- just set it to null.'\n    )\n    return\n  }\n  // 2.\u5982\u679c\u672c\u8eab\u5c31\u6ca1\u6709\u8fd9\u4e2a\u5c5e\u6027\u4ec0\u4e48\u90fd\u4e0d\u505a\n  if (!hasOwn(target, key)) {\n    return\n  }\n  // 3.\u5220\u9664\u8fd9\u4e2a\u5c5e\u6027\n  delete target[key]\n  if (!ob) {\n    return\n  }\n  // 4.\u901a\u77e5\u66f4\u65b0\n  ob.dep.notify()\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Vue\u7684\u7f3a\u9677\uff1a\u65b0\u589e\u4e4b\u524d\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\u4e0d\u4f1a\u53d1\u751f\u89c6\u56fe\u66f4\u65b0\uff0c\u4fee\u6539\u6570\u7ec4\u7d22\u5f15\u4e0d\u4f1a\u53d1\u751f\u89c6\u56fe\u66f4\u65b0 (\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u901a\u8fc7$set\u65b9\u6cd5,\u6570\u7ec4\u901a\u8fc7splice\u8fdb\u884c\u66f4\u65b0\u89c6\u56fe\uff0c\u5bf9\u8c61\u5219\u624b\u52a8\u901a\u77e5)")),(0,i.kt)("h3",{id:"3vuenexttick"},"3.Vue.nextTick"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const callbacks = []; // \u5b58\u653enextTick\u56de\u8c03\nlet pending = false; \nfunction flushCallbacks () { // \u6e05\u7a7a\u961f\u5217\n  pending = false\n  const copies = callbacks.slice(0)\n  callbacks.length = 0\n  for (let i = 0; i < copies.length; i++) {\n    copies[i]()\n  }\n}\nlet timerFunc\nexport function nextTick (cb?: Function, ctx?: Object) {\n  let _resolve\n  callbacks.push(() => {\n    if (cb) {\n      try {\n        cb.call(ctx) // 1.\u5c06\u56de\u8c03\u51fd\u6570\u5b58\u5165\u5230callbacks\u4e2d\n      } catch (e) {\n        handleError(e, ctx, 'nextTick')\n      }\n    } else if (_resolve) {\n      _resolve(ctx)\n    }\n  })\n  if (!pending) {\n    pending = true\n    timerFunc();     // 2.\u5f02\u6b65\u5237\u65b0\u961f\u5217\n  }\n  // 3.\u652f\u6301promise\u5199\u6cd5\n  if (!cb && typeof Promise !== 'undefined') {\n    return new Promise(resolve => { \n      _resolve = resolve\n    })\n  }\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u4e0d\u96be\u770b\u51fanextTick\u539f\u7406\u5c31\u662f\u5c06\u56de\u8c03\u51fd\u6570\u5b58\u5165\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\uff0c\u6700\u540e\u5f02\u6b65\u7684\u6e05\u7a7a\u8fd9\u4e2a\u961f\u5217")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"timerFunc")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// 1.\u9ed8\u8ba4\u5148\u4f7f\u7528Promise \u56e0\u4e3amutationObserver\u6709bug\u53ef\u80fd\u4e0d\u5de5\u4f5c\nif (typeof Promise !== 'undefined' && isNative(Promise)) {\n  const p = Promise.resolve()\n  timerFunc = () => {\n    p.then(flushCallbacks)\n    // \u89e3\u51b3\u961f\u5217\u4e0d\u5237\u65b0\u95ee\u9898\n    if (isIOS) setTimeout(noop)\n  }\n  isUsingMicroTask = true\n// 2.\u4f7f\u7528MutationObserver\n} else if (!isIE && typeof MutationObserver !== 'undefined' && (\n  isNative(MutationObserver) ||\n  \n  MutationObserver.toString() === '[object MutationObserverConstructor]'\n)) {\n  let counter = 1\n  const observer = new MutationObserver(flushCallbacks)\n  const textNode = document.createTextNode(String(counter))\n  observer.observe(textNode, {\n    characterData: true\n  })\n  timerFunc = () => {\n    counter = (counter + 1) % 2\n    textNode.data = String(counter)\n  }\n  isUsingMicroTask = true\n// 3.\u4f7f\u7528 setImmediate\n} else if (typeof setImmediate !== 'undefined' && isNative(setImmediate)) {\n  timerFunc = () => {\n    setImmediate(flushCallbacks)\n  }\n// 4.\u4f7f\u7528setTimeout\n} else {\n  timerFunc = () => {\n    setTimeout(flushCallbacks, 0)\n  }\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u91c7\u7528EventLoop\u4e2d\u7684\u5fae\u4efb\u52a1\u548c\u5b8f\u4efb\u52a1\uff0c\u5148\u91c7\u7528\u5fae\u4efb\u52a1\u5e76\u6309\u7167\u4f18\u5148\u7ea7\u4f18\u96c5\u964d\u7ea7\u7684\u65b9\u5f0f\u5b9e\u73b0\u5f02\u6b65\u5237\u65b0")),(0,i.kt)("h3",{id:"4vueobservable"},"4.Vue.observable"),(0,i.kt)("p",null,"2.6\u65b0\u589e\u7684\u65b9\u6cd5\uff0c\u5c06\u5bf9\u8c61\u8fdb\u884c\u89c2\u6d4b\uff0c\u5e76\u8fd4\u56de\u89c2\u6d4b\u540e\u7684\u5bf9\u8c61\u3002\u53ef\u4ee5\u7528\u6765\u505a\u5168\u5c40\u53d8\u91cf\uff0c\u5b9e\u73b0\u6570\u636e\u5171\u4eab"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"Vue.observable = <T>(obj: T): T => {\n    observe(obj)\n    return obj\n}\n")),(0,i.kt)("h3",{id:"5vueoptions"},"5.Vue.options"),(0,i.kt)("p",null,"\u5b58\u653e\u5168\u5c40\u7684\u7ec4\u4ef6\u3001\u6307\u4ee4\u3001\u8fc7\u6ee4\u5668\u7684\u4e00\u4e2a\u5bf9\u8c61,\u53ca\u62e5\u6709",(0,i.kt)("inlineCode",{parentName:"p"},"_base"),"\u5c5e\u6027\u4fdd\u5b58Vue\u7684\u6784\u9020\u51fd\u6570"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"ASSET_TYPES.forEach(type => {\n    Vue.options[type + 's'] = Object.create(null)\n})\nVue.options._base = Vue\nextend(Vue.options.components, builtInComponents) // \u5185\u7f6e\u4e86 keep-alive\n")),(0,i.kt)("h3",{id:"6vueuse"},"6.Vue.use"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Vue.use")," \u4e3b\u8981\u7684\u4f5c\u7528\u5c31\u662f\u8c03\u7528\u63d2\u4ef6\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"install"),"\u65b9\u6cd5,\u5e76\u5c06",(0,i.kt)("inlineCode",{parentName:"p"},"Vue"),"\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u53ef\u4ee5\u907f\u514d\u6211\u4eec\u7f16\u5199\u63d2\u4ef6\u65f6\u9700\u8981\u4f9d\u8d56Vue\u5bfc\u81f4\u7248\u672c\u95ee\u9898\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"initUse(Vue)\n\nVue.use = function (plugin: Function | Object) {\n    const installedPlugins = (this._installedPlugins || (this._installedPlugins = []))\n    // 1.\u5982\u679c\u5b89\u88c5\u8fc7\u8fd9\u4e2a\u63d2\u4ef6\u76f4\u63a5\u8df3\u51fa\n    if (installedPlugins.indexOf(plugin) > -1) {\n      return this\n    }\n    // 2.\u83b7\u53d6\u53c2\u6570\u5e76\u5728\u53c2\u6570\u4e2d\u589e\u52a0Vue\u7684\u6784\u9020\u51fd\u6570\n    const args = toArray(arguments, 1)\n    args.unshift(this)\n    // 3.\u6267\u884cinstall\u65b9\u6cd5\n    if (typeof plugin.install === 'function') {\n      plugin.install.apply(plugin, args)\n    } else if (typeof plugin === 'function') {\n      plugin.apply(null, args)\n    }\n    // 4.\u8bb0\u5f55\u5b89\u88c5\u7684\u63d2\u4ef6\n    installedPlugins.push(plugin)\n    return this\n}\n")),(0,i.kt)("h3",{id:"7vuemixin"},"7.Vue.mixin"),(0,i.kt)("p",null,"\u5168\u5c40\u6df7\u5408\u65b9\u6cd5,\u53ef\u4ee5\u7528\u6765\u63d0\u53d6\u516c\u5171\u65b9\u6cd5\u53ca\u72b6\u6001\u7b49."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"Vue.mixin = function (mixin: Object) {\n    this.options = mergeOptions(this.options, mixin)\n    return this\n}\n")),(0,i.kt)("p",null,"Vue\u5bf9\u4e0d\u540c\u7684\u5c5e\u6027\u505a\u4e86\u4e0d\u540c\u7684\u5408\u5e76\u7b56\u7565"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function mergeOptions (\n  parent: Object,\n  child: Object,\n  vm?: Component\n): Object {\n  if (!child._base) { // 1.\u7ec4\u4ef6\u5148\u5c06\u81ea\u5df1\u7684extends\u548cmixin\u4e0e\u7236\u5c5e\u6027\u5408\u5e76\n    if (child.extends) {\n      parent = mergeOptions(parent, child.extends, vm)\n    }\n    if (child.mixins) {\n      for (let i = 0, l = child.mixins.length; i < l; i++) {\n        parent = mergeOptions(parent, child.mixins[i], vm)\n      }\n    }\n  }\n  // 2.\u518d\u7528\u4e4b\u524d\u5408\u5e76\u540e\u7684\u7ed3\u679c\uff0c\u4e0e\u81ea\u8eab\u7684\u5c5e\u6027\u8fdb\u884c\u5408\u5e76\n  const options = {}\n  let key\n  for (key in parent) {\n    mergeField(key)\n  }\n  for (key in child) {\n    if (!hasOwn(parent, key)) {\n      mergeField(key)\n    }\n  }\n  function mergeField (key) {\n    const strat = strats[key] || defaultStrat; // 3.\u91c7\u7528\u4e0d\u540c\u7684\u5408\u5e76\u7b56\u7565\n    options[key] = strat(parent[key], child[key], vm, key)\n  }\n  return options\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u4f60\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b",(0,i.kt)("inlineCode",{parentName:"p"},"strats"),"\u8fd9\u4e2a\u5bf9\u8c61\u6765\u4e86\u89e3\u4e0d\u540c\u7684\u5408\u5e76\u7b56\u7565\u3002")),(0,i.kt)("h3",{id:"8vueextend"},"8.Vue.extend"),(0,i.kt)("p",null,"Vue\u4e2d\u975e\u5e38\u6838\u5fc3\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f20\u5165\u7684\u5bf9\u8c61\u83b7\u53d6\u8fd9\u4e2a\u5bf9\u8c61\u7684\u6784\u9020\u51fd\u6570\uff0c\u540e\u7eed\u5728\u7ec4\u4ef6\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u4f1a\u7528\u5230\u6b64\u65b9\u6cd5"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"Vue.extend = function (extendOptions: Object): Function {\n    // ...\n    const Sub = function VueComponent (options) {\n      this._init(options)\n    }\n    Sub.prototype = Object.create(Super.prototype)\n    Sub.prototype.constructor = Sub\n    Sub.options = mergeOptions( // \u5b50\u7ec4\u4ef6\u7684\u9009\u9879\u548cVue.options\u8fdb\u884c\u5408\u5e76\n      Super.options,\n      extendOptions\n    )\n    // ...\n    return Sub; \n  }\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("inlineCode",{parentName:"p"},"extend")," \u521b\u5efa\u7684\u662f Vue \u6784\u9020\u5668,\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5b9e\u4f8b\u5316\u5e76\u4e14\u5c06\u5176\u6302\u8f7d\u5728\u4efb\u610f\u7684\u5143\u7d20\u4e0a")),(0,i.kt)("h3",{id:"9\u7ec4\u4ef6\u6307\u4ee4\u8fc7\u6ee4\u5668"},"9.\u7ec4\u4ef6\u3001\u6307\u4ee4\u3001\u8fc7\u6ee4\u5668"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"initAssetRegisters(Vue)\n\nASSET_TYPES.forEach(type => {\n    Vue[type] = function (\n      id: string,\n      definition: Function | Object\n    ): Function | Object | void {\n      if (!definition) {\n        return this.options[type + 's'][id]\n      } else {\n        /* istanbul ignore if */\n        if (process.env.NODE_ENV !== 'production' && type === 'component') {\n          validateComponentName(id)\n        }\n        if (type === 'component' && isPlainObject(definition)) {\n          definition.name = definition.name || id\n          definition = this.options._base.extend(definition)\n        }\n        if (type === 'directive' && typeof definition === 'function') {\n          definition = { bind: definition, update: definition }\n        }\n        this.options[type + 's'][id] = definition; // \u5c06\u6307\u4ee4\u3001\u8fc7\u6ee4\u5668\u3001\u7ec4\u4ef6 \u7ed1\u5b9a\u5728Vue.options\u4e0a\n\n        // \u5907\u6ce8\uff1a\u5168\u5c40\u7ec4\u4ef6\u3001\u6307\u4ee4\u8fc7\u6ee4\u5668\u5176\u5b9e\u5c31\u662f\u5b9a\u4e49\u5728 Vue.options\u4e2d\uff0c\u8fd9\u6837\u521b\u5efa\u5b50\u7ec4\u4ef6\u65f6\u90fd\u4f1a\u548cVue.options\u8fdb\u884c\u5408\u5e76\uff0c\u6240\u4ee5\u5b50\u7ec4\u4ef6\u53ef\u4ee5\u62ff\u5230\u5168\u5c40\u7684\u5b9a\u4e49\n\n        return definition\n      }\n    }\n})\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u521d\u59cb\u5316\u5168\u5c40\u7684api\uff0cVue.component\u3001Vue.directive\u3001Vue.filter\uff0c\u8fd9\u91cc\u4ec5\u4ec5\u662f\u683c\u5f0f\u5316\u7528\u6237\u4f20\u5165\u7684\u5185\u5bb9\uff0c\u5c06\u5176\u7ed1\u5b9a\u5728Vue.options\u9009\u9879\u4e0a")),(0,i.kt)("h2",{id:"\u4e8c\u5256\u6790vue\u7684\u521d\u59cb\u5316\u8fc7\u7a0b"},"\u4e8c.\u5256\u6790Vue\u7684\u521d\u59cb\u5316\u8fc7\u7a0b"),(0,i.kt)("p",null,"\u5728\u4e0a\u4e00\u8282\u4e2d\u6211\u4eec\u5df2\u7ecf\u67e5\u627e\u5230\u4e86Vue\u7684\u6784\u9020\u51fd\u6570"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"function Vue (options) {\n  if (process.env.NODE_ENV !== 'production' &&\n    !(this instanceof Vue)\n  ) {\n    warn('Vue is a constructor and should be called with the `new` keyword')\n  }\n  this._init(options) // \u5f53new Vue\u65f6\u4f1a\u8c03\u7528 _init\u65b9\u6cd5\n}\n\ninitMixin(Vue)       // \u521d\u59cb\u5316_init\u65b9\u6cd5\nstateMixin(Vue)      // $set / $delete / $watch\neventsMixin(Vue)     // $on $once $off $emit\nlifecycleMixin(Vue)  // _update\nrenderMixin(Vue)     // _render $nextTick\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Vue\u7684\u6e90\u7801\u7ed3\u6784\u975e\u5e38\u7684\u6e05\u6670,\u5c31\u662f\u5bf9\u539f\u578b\u8fdb\u884c\u4e86\u6269\u5c55\u800c\u5df2\u3002")),(0,i.kt)("h3",{id:"1vue\u7684\u521d\u59cb\u5316"},"1.Vue\u7684\u521d\u59cb\u5316"),(0,i.kt)("p",null,"\u901a\u8fc7Vue\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"_init"),"\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5185\u90e8\u53c8\u5305\u542b\u4e86\u5f88\u591a\u521d\u59cb\u5316\u7684\u8fc7\u7a0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function initMixin (Vue: Class<Component>) {\n  Vue.prototype._init = function (options?: Object) {\n    const vm: Component = this\n    // 1.\u6bcf\u4e2avue\u7684\u5b9e\u4f8b\u4e0a\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u5c5e\u6027_uid\n    vm._uid = uid++ \n    // 2.\u8868\u793a\u662fVue\u7684\u5b9e\u4f8b\n    vm._isVue = true\n\n    // 3.\u9009\u9879\u5408\u5e76\u7b56\u7565\n    if (options && options._isComponent) {\n      initInternalComponent(vm, options)\n    } else {\n      vm.$options = mergeOptions(\n        resolveConstructorOptions(vm.constructor),\n        options || {},\n        vm\n      )\n    }\n    vm._self = vm\n    // 4.\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\n    initLifecycle(vm)\n    initEvents(vm)\n    initRender(vm)\n    callHook(vm, 'beforeCreate')\n    initInjections(vm) \n    initState(vm)\n    initProvide(vm) \n    callHook(vm, 'created')\n\n    // 5.\u5982\u679c\u6709el\u5c31\u5f00\u59cb\u8fdb\u884c\u6302\u8f7d\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el)\n    }\n  }\n}\n")),(0,i.kt)("h3",{id:"2_init\u65b9\u6cd5\u4e2d\u7684\u521d\u59cb\u5316"},"2._init\u65b9\u6cd5\u4e2d\u7684\u521d\u59cb\u5316"),(0,i.kt)("p",null,'\u8fd9\u4e2a\u4ee3\u7801\u5199\u7684\u771f\u662f\u4e00\u76ee\u4e86\u7136\uff0c\u6211\u4eec\u5148\u770b\u770b\u6bcf\u4e2a\u65b9\u6cd5"\u5927\u6982"\u5e72\u4e86\u4ec0\u4e48\u4e8b\uff0c\u5207\u8bb0\u4e0d\u8981\u6b7b\u8ffd\u5230\u5e95!'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"initLifecycle(vm) // \u521d\u59cb\u5316\u7ec4\u4ef6\u95f4\u7684\u7236\u5b50\u5173\u7cfb \ninitEvents(vm)    // \u66f4\u65b0\u7ec4\u4ef6\u7684\u4e8b\u4ef6\ninitRender(vm)    // \u521d\u59cb\u5316_c\u65b9\u6cd5\ninitInjections(vm)// \u521d\u59cb\u5316inject\ninitState(vm)     // \u521d\u59cb\u5316\u72b6\u6001\ninitProvide(vm)   // \u521d\u59cb\u5316provide\n")),(0,i.kt)("h3",{id:"3\u6302\u8f7d\u6d41\u7a0b"},"3.\u6302\u8f7d\u6d41\u7a0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// 1.\u5982\u679c\u6709el\u5c31\u5f00\u59cb\u6302\u8f7d \nif (vm.$options.el) {\n    vm.$mount(vm.$options.el)\n}\n\n// 2.\u7ec4\u4ef6\u7684\u6302\u8f7d\nVue.prototype.$mount = function (el,hydrating){\n  el = el && inBrowser ? query(el) : undefined\n  return mountComponent(this, el, hydrating);\n}\n\n// 3.\u521b\u5efa\u6e32\u67d3watcher\u8fdb\u884c\u6e32\u67d3\nexport function mountComponent (vm,el,hydrating) {\n  vm.$el = el\n  let updateComponent\n  updateComponent = () => {\n      vm._update(vm._render(), hydrating)\n  }\n  new Watcher(vm, updateComponent, noop, { // \u521b\u5efa\u6e32\u67d3Watcher\n    before () {\n      if (vm._isMounted && !vm._isDestroyed) {\n        callHook(vm, 'beforeUpdate')\n      }\n    }\n  }, true /* isRenderWatcher */)\n  return vm\n}\n")),(0,i.kt)("h1",{id:"\u5256\u6790\u6e90\u7801\u54cd\u5e94\u5f0f\u53d8\u5316\u539f\u7406-\u4e09"},"\u5256\u6790\u6e90\u7801\u54cd\u5e94\u5f0f\u53d8\u5316\u539f\u7406 (\u4e09)"),(0,i.kt)("h2",{id:"\u4e00\u6570\u636e\u52ab\u6301"},"\u4e00.\u6570\u636e\u52ab\u6301"),(0,i.kt)("p",null,"\u5728\u4e0a\u8282\u4e2d\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\uff0cvue\u5728\u54ea\u91cc\u505a\u4e86\u72b6\u6001\u7684\u521d\u59cb\u5316\uff08",(0,i.kt)("inlineCode",{parentName:"p"},"initState"),"\uff09"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function initState (vm: Component) {\n  vm._watchers = []\n  const opts = vm.$options\n  if (opts.props) initProps(vm, opts.props)\n  if (opts.methods) initMethods(vm, opts.methods)\n  if (opts.data) {\n    initData(vm)\n  } else {\n    observe(vm._data = {}, true /* asRootData */)\n  }\n  if (opts.computed) initComputed(vm, opts.computed)\n  if (opts.watch && opts.watch !== nativeWatch) {\n    initWatch(vm, opts.watch)\n  }\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u53c8\u8fdb\u884c\u4e86\u7ec6\u5316\u548c\u62c6\u5206\uff0c\u5bf9\u4e0d\u540c\u7684\u5c5e\u6027\u505a\u4e86\u4e0d\u540c\u7684\u521d\u59cb\u5316\u64cd\u4f5c,\u539f\u6765\u6211\u4eec\u5e38\u7528\u7684api\u90fd\u5728\u8fd9\u91cc\u505a\u7684\u521d\u59cb\u5316~")),(0,i.kt)("h3",{id:"1\u6570\u636e\u7684\u521d\u59cb\u5316"},"1.\u6570\u636e\u7684\u521d\u59cb\u5316"),(0,i.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u5148\u5173\u5fc3\u6570\u636e\u662f\u5982\u4f55\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\u7684"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"function initData (vm: Component) {\n  let data = vm.$options.data\n  data = vm._data = typeof data === 'function'\n    ? getData(data, vm)\n    : data || {}\n  // 1.\u6570\u636e\u4e0d\u662f\u5bf9\u8c61\u5219\u53d1\u751f\u5f02\u5e38\n  if (!isPlainObject(data)) {  \n    data = {}\n    process.env.NODE_ENV !== 'production' && warn(\n      'data functions should return an object:\\n' +\n      'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function',\n      vm\n    )\n  }\n  const keys = Object.keys(data)\n  const props = vm.$options.props\n  const methods = vm.$options.methods\n  let i = keys.length\n  // 2.\u6821\u9a8c\u6570\u636e\u662f\u5426\u5728method\u4e2d\u5df2\u7ecf\u58f0\u660e\u8fc7\n  while (i--) {               \n    const key = keys[i]\n    if (process.env.NODE_ENV !== 'production') {\n      if (methods && hasOwn(methods, key)) {\n        warn(\n          `Method \"${key}\" has already been defined as a data property.`,\n          vm\n        )\n      }\n    }\n    // 3.\u6821\u9a8c\u6570\u636e\u662f\u5426\u5728\u5c5e\u6027\u4e2d\u5df2\u7ecf\u58f0\u660e\u8fc7\n    if (props && hasOwn(props, key)) {\n      process.env.NODE_ENV !== 'production' && warn(\n        `The data property \"${key}\" is already declared as a prop. ` +\n        `Use prop default value instead.`,\n        vm\n      )\n    } else if (!isReserved(key)) {\n      // 4.\u5c06_data\u4ee3\u7406\u5230\u5b9e\u4f8b\u4e0a\n      proxy(vm, `_data`, key) \n    }\n  }\n  // 5.\u89c2\u6d4b\u6570\u636e\n  observe(data, true /* asRootData */)\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u4e3b\u8981\u662f\u68c0\u6d4b\u5c5e\u6027\u662f\u5426\u88ab\u91cd\u590d\u58f0\u660e\uff0c\u5e76\u5bf9\u5c5e\u6027\u8fdb\u884c\u89c2\u6d4b")),(0,i.kt)("h3",{id:"2\u89c2\u6d4b\u6570\u636e"},"2.\u89c2\u6d4b\u6570\u636e"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function observe (value: any, asRootData: ?boolean): Observer | void {\n  // 1.\u5982\u679c\u4e0d\u662f\u5bf9\u8c61\u76f4\u63a5return\n  if (!isObject(value) || value instanceof VNode) {\n    return\n  }\n  let ob: Observer | void\n  // 2.\u5982\u679c\u5df2\u7ecf\u89c2\u6d4b\u8fc7\u5219\u76f4\u63a5\u8fd4\u56de\u4e0a\u6b21\u89c2\u6d4b\u7684\u5b9e\u4f8b\n  if (hasOwn(value, '__ob__') && value.__ob__ instanceof Observer) { // \n    ob = value.__ob__\n  } else if (\n    shouldObserve &&\n    !isServerRendering() &&\n    (Array.isArray(value) || isPlainObject(value)) &&\n    Object.isExtensible(value) &&\n    !value._isVue\n  ) {\n  // 3.\u5982\u679c\u53ef\u4ee5\u89c2\u6d4b\u5c31\u8fdb\u884c\u89c2\u6d4b\n    ob = new Observer(value)\n  }\n  // 4.\u5982\u679c\u662f\u6839\u6570\u636e  vmCount\u6807\u6ce8\u4e3a1\n  if (asRootData && ob) {\n    ob.vmCount++\n  }\n  return ob\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u53ea\u89c2\u6d4b\u5bf9\u8c61\u6570\u636e\u7c7b\u578b\uff0c\u5df2\u7ecf\u89c2\u6d4b\u7684\u4e0d\u5728\u8fdb\u884c\u89c2\u6d4b\uff0c\u4e0d\u80fd\u6269\u5c55\u7684\u5c5e\u6027\u4e0d\u8fdb\u884c\u89c2\u6d4b\u3002")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export class Observer {\n  constructor (value: any) {\n    this.value = value\n    this.dep = new Dep()\n    this.vmCount = 0\n    def(value, '__ob__', this)\n    // 1.\u6570\u7ec4\u7684\u8bdd\u91cd\u5199\u6570\u7ec4\u539f\u578b\u65b9\u6cd5 \n    if (Array.isArray(value)) { \n      if (hasProto) {\n        protoAugment(value, arrayMethods)\n      } else {\n        copyAugment(value, arrayMethods, arrayKeys)\n      }\n      // 2.\u89c2\u6d4b\u6570\u7ec4\u4e2d\u662f\u5bf9\u8c61\u7c7b\u578b\u7684\u6570\u636e\n      this.observeArray(value) \n    } else { \n      // 3.\u5bf9\u8c61\u7684\u8bdd\u4f7f\u7528defineProperty\u91cd\u65b0\u5b9a\u4e49\u5c5e\u6027\n      this.walk(value)         \n    }\n  }\n  \n  walk (obj: Object) { \n    const keys = Object.keys(obj)\n    for (let i = 0; i < keys.length; i++) {\n      defineReactive(obj, keys[i])\n    }\n  }\n\n  observeArray (items: Array<any>) {\n    for (let i = 0, l = items.length; i < l; i++) {\n      observe(items[i])\n    }\n  }\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u8981\u533a\u5206\u5bf9\u8c61\u548c\u6570\u7ec4\uff0c\u5982\u679c\u662f\u6570\u7ec4\u4e0d\u80fd\u4f7f\u7528Object.defineProperty\u4f1a\u9020\u6210\u6027\u80fd\u6d6a\u8d39\uff0c\u6240\u4ee5\u91c7\u7528\u91cd\u5199\u53ef\u4ee5\u66f4\u6539\u6570\u7ec4\u672c\u8eab\u7684\u65b9\u6cd5\u7684\u65b9\u5f0f\u3002")),(0,i.kt)("h3",{id:"3\u5bf9\u8c61\u7684\u89c2\u6d4b"},"3.\u5bf9\u8c61\u7684\u89c2\u6d4b"),(0,i.kt)("p",null,"\u5bf9\u8c61\u7684\u89c2\u6d4b\u5c31\u662f\u5c06\u6240\u6709\u5c5e\u6027\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"defineProperty"),"\u8fdb\u884c\u91cd\u65b0\u5b9a\u4e49"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function defineReactive (\n  obj: Object,\n  key: string,\n  val: any,\n  customSetter?: ?Function,\n  shallow?: boolean\n) {\n  // 1.\u5982\u679c\u5bf9\u8c61\u4e0d\u53ef\u914d\u7f6e\u5219\u76f4\u63a5\u9000\u51fa\n  const property = Object.getOwnPropertyDescriptor(obj, key)\n  if (property && property.configurable === false) {\n    return\n  }\n\n  // 2.\u83b7\u53d6getter\u548csetter\n  const getter = property && property.get\n  const setter = property && property.set\n  \n  // 3.\u91cd\u65b0\u5b9a\u4e49set\u548cget\u65b9\u6cd5\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter () {\n      const value = getter ? getter.call(obj) : val\n      return value\n    },\n    set: function reactiveSetter (newVal) {\n      const value = getter ? getter.call(obj) : val\n      if (newVal === value || (newVal !== newVal && value !== value)) {\n        return\n      }\n      if (getter && !setter) return\n      if (setter) {\n        setter.call(obj, newVal)\n      } else {\n        val = newVal\n      }\n    }\n  })\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5bf9\u8c61\u7684\u5c5e\u6027\u52ab\u6301\u5df2\u7ecf\u70c2\u5927\u8857\u4e86\uff0c\u975e\u5e38\u7b80\u5355\u5c31\u662f\u901a\u8fc7",(0,i.kt)("inlineCode",{parentName:"p"},"defineProperty"),"\u6765\u5b9e\u73b0\u7684,\u5982\u679c\u4f60\u8fd8\u4e0d\u4f1a\u90a3\u5f97\u597d\u597d\u53cd\u601d\u4e00\u4e0b\u4e86\u3002\u8fd9\u91cc\u63d0\u4e00\u4e0b\uff1a\u60f3\u51cf\u5c11\u89c2\u6d4b\u53ef\u4ee5\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"Object.freeze"),"\u51bb\u7ed3\u5bf9\u8c61")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"img",src:t(6795).Z,width:"552",height:"482"})),(0,i.kt)("h3",{id:"4\u6570\u7ec4\u7684\u89c2\u6d4b"},"4.\u6570\u7ec4\u7684\u89c2\u6d4b"),(0,i.kt)("p",null,"\u6570\u7ec4\u7684\u89c2\u6d4b\u5c31\u662f\u901a\u8fc7\u91cd\u5199\u539f\u578b\u65b9\u6cd5\u6765\u5b9e\u73b0\u7684"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export const arrayMethods = Object.create(arrayProto)\nconst methodsToPatch = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse'\n]\nmethodsToPatch.forEach(function (method) {\n  // cache original method\n  const original = arrayProto[method]\n  def(arrayMethods, method, function mutator (...args) {\n    const result = original.apply(this, args)\n    const ob = this.__ob__\n    let inserted\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n        break\n    }\n    // \u5bf9\u65b0\u589e\u7684\u5c5e\u6027\u518d\u6b21\u8fdb\u884c\u89c2\u6d4b\n    if (inserted) ob.observeArray(inserted)\n    return result\n  })\n})\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u6211\u4eec\u6240\u8c13\u7684\u6570\u636e\u89c2\u6d4b\u5c31\u662f\u5f53\u6570\u636e\u53d8\u5316\u65f6\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u50cf\u5bf9\u8c61\u66f4\u6539\u65f6\u53ef\u4ee5\u51fa\u53d1",(0,i.kt)("inlineCode",{parentName:"p"},"set"),"\u65b9\u6cd5,\u50cf\u6570\u7ec4\u8c03\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"push"),"\u65b9\u6cd5\u53ef\u4ee5\u89e6\u53d1\u6211\u4eec\u81ea\u5df1\u5199\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"push"))),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"img",src:t(3930).Z,width:"638",height:"426"})),(0,i.kt)("h2",{id:"\u4e8c\u4f9d\u8d56\u6536\u96c6"},"\u4e8c.\u4f9d\u8d56\u6536\u96c6"),(0,i.kt)("p",null,"\u8fd9\u91cc\u6211\u4eec\u8981\u56de\u60f3\u4e00\u4e0b",(0,i.kt)("inlineCode",{parentName:"p"},"vue"),"\u7684\u6e32\u67d3\u8fc7\u7a0b\u662f\u901a\u8fc7\u6e32\u67d3",(0,i.kt)("inlineCode",{parentName:"p"},"watcher"),"\u6765\u5b9e\u73b0\u7684"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"let updateComponent = updateComponent = () => {\n      vm._update(vm._render(), hydrating)\n}\nnew Watcher(vm, updateComponent, noop, {}, true /* isRenderWatcher */)\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5728\u6211\u4eec\u521b\u5efa",(0,i.kt)("inlineCode",{parentName:"p"},"watcher"),"\u65f6\uff0c\u4f1a\u5bf9\u53d8\u91cf\u8fdb\u884c\u53d6\u503c")),(0,i.kt)("h3",{id:"21-\u5bf9\u8c61\u4f9d\u8d56\u6536\u96c6"},"2.1 \u5bf9\u8c61\u4f9d\u8d56\u6536\u96c6"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u5bf9\u8c61\u800c\u8a00,\u53d6\u503c\u5c31\u4f1a\u89e6\u53d1get\u65b9\u6cd5,\u6211\u4eec\u53ef\u4ee5\u5728defineProperty\u7684get\u4e2d\u8fdb\u884c\u4f9d\u8d56\u6536\u96c6,\u5728set\u4e2d\u901a\u77e5",(0,i.kt)("inlineCode",{parentName:"p"},"watcher"),"\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"class Watcher {\n  constructor (\n    vm: Component,\n    expOrFn: string | Function, // updateComponent\n    cb: Function,\n    options?: ?Object,\n    isRenderWatcher?: boolean\n  ) {\n    this.vm = vm\n    if (isRenderWatcher) {\n      vm._watcher = this\n    }\n    this.cb = cb\n    this.id = ++uid // uid for batching\n    this.active = true\n    this.dirty = this.lazy // for lazy watchers\n    this.deps = []\n    this.newDeps = []\n    this.depIds = new Set()\n    this.newDepIds = new Set()\n    this.expression = process.env.NODE_ENV !== 'production'\n      ? expOrFn.toString()\n      : ''\n    // \u5c06updateComponent \u653e\u5230this.getter\u4e0a\n    this.getter = expOrFn\n    this.value = this.lazy\n      ? undefined\n      : this.get() // \u6267\u884cget\u65b9\u6cd5\n  }\n  get () {\n    pushTarget(this)  // Dep.target = \u6e32\u67d3watcher\n    let value\n    const vm = this.vm\n    try {\n      value = this.getter.call(vm, vm) // \u5f00\u59cb\u53d6\u503c \u90a3\u4e48\u5728get\u65b9\u6cd5\u4e2d\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u8fd9\u4e2a\u5168\u5c40\u53d8\u91cfDep.target        \n    } catch (e) {\n      if (this.user) {\n        handleError(e, vm, `getter for watcher \"${this.expression}\"`)\n      } else {\n        throw e\n      }\n    } finally {\n      // \"touch\" every property so they are all tracked as\n      // dependencies for deep watching\n      if (this.deep) {\n        traverse(value)\n      }\n      popTarget() // \u7ed3\u675f\u540e\u8fdb\u884c\u6e05\u7406\u64cd\u4f5c\n      this.cleanupDeps()\n    }\n    return value\n  }\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u6e32\u67d3watcher\uff0c\u9ed8\u8ba4\u4f1a\u8c03\u7528get\u65b9\u6cd5\u4e5f\u5c31\u662f\u6211\u4eec\u4f20\u5165\u7684updateComponent\u65b9\u6cd5,\u5728\u8c03\u7528\u6b64\u65b9\u6cd5\u524d\u5148\u5c06watcher\u5b58\u5230\u5168\u5c40\u4e2d\uff0c\u8fd9\u6837\u518d\u53d6\u503c\u65f6\u53ef\u4ee5\u83b7\u53d6\u5230\u8fd9\u4e2awatcher\u3002")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const dep = new Dep()\nget: function reactiveGetter () {\n    const value = getter ? getter.call(obj) : val\n    if (Dep.target) { // \u5982\u679c\u6709watcher \u5c06dep\u548cwatcher\u5bf9\u5e94\u8d77\u6765\n        dep.depend()\n    }\n    return value\n}\nset: function reactiveSetter (newVal) {\n    dep.notify();    // \u5f53\u5c5e\u6027\u66f4\u65b0\u65f6\u901a\u77e5dep\u4e2d\u7684\u6240\u6709watcher\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\n}\n")),(0,i.kt)("h3",{id:"22-\u6570\u7ec4\u7684\u4f9d\u8d56\u6536\u96c6"},"2.2 \u6570\u7ec4\u7684\u4f9d\u8d56\u6536\u96c6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"let childOb = !shallow && observe(val)\nget: function reactiveGetter () {\n      const value = getter ? getter.call(obj) : val\n      if (Dep.target) {\n        dep.depend()\n        if (childOb) { // \u5982\u679c\u503c\u4e5f\u662f\u4e2a\u5bf9\u8c61\u7684\u8bdd\uff0c\u5bf9\u8fd9\u4e2a\u503c\u8fdb\u884c\u4f9d\u8d56\u6536\u96c6\n          childOb.dep.depend() \n          if (Array.isArray(value)) { // \u5982\u679c\u662f\u6570\u7ec4\u5bf9\u6570\u7ec4\u4e2d\u7684\u5185\u5bb9\u7ee7\u7eed\u8fdb\u884c\u4f9d\u8d56\u6536\u96c6\n            dependArray(value) \n          }\n        }\n      }\n      return value\n}\n// \u8c03\u7528\u6570\u7ec4\u65b9\u6cd5\u65f6\u8fdb\u884cwatcher\u7684\u66f4\u65b0\u64cd\u4f5c\nmethodsToPatch.forEach(function (method) {\n    ob.dep.notify()\n})\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u7684watcher\u548cdep\u7684\u5173\u7cfb\u662f\u591a\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u4e00\u4e2a\u5c5e\u6027\u4e00\u4e2adep\uff0c\u6bcf\u4e2adep\u91cc\u5b58\u653e\u7740\u591a\u4e2awatcher\uff0c\u540c\u65f6watcher\u4e5f\u4f1a\u8bb0\u4f4f\u5bf9\u5e94\u7684dep\u3002")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export default class Dep {\n  constructor () {\n    this.id = uid++\n    this.subs = []\n  }\n  addSub (sub: Watcher) {\n    this.subs.push(sub)\n  }\n\n  depend () {\n    if (Dep.target) { \n      Dep.target.addDep(this) // \u8ba9watcher\u8bb0\u4f4f\u81ea\u5df1\n    }\n  }\n\n  notify () {\n    const subs = this.subs.slice()\n    for (let i = 0, l = subs.length; i < l; i++) {\n      subs[i].update() // \u8ba9\u5b58\u50a8\u7684watcher\u4f9d\u6b21\u8c03\u7528\u66f4\u65b0\u65b9\u6cd5\n    }\n  }\n}\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"class Watcher {\n  constructor (\n    vm: Component,\n    expOrFn: string | Function, // updateComponent\n    cb: Function,\n    options?: ?Object,\n    isRenderWatcher?: boolean\n  ) {\n    this.deps = []\n    this.newDeps = []\n    this.depIds = new Set()\n    this.newDepIds = new Set()\n    this.expression = process.env.NODE_ENV !== 'production'\n      ? expOrFn.toString()\n      : ''\n    // 1.\u5c06updateComponent \u653e\u5230this.getter\u4e0a\n    this.getter = expOrFn\n    this.value = this.lazy\n      ? undefined\n    // 2.\u6267\u884cget\u65b9\u6cd5\n      : this.get()\n  }\n  addDep (dep: Dep) { \n        const id = dep.id\n        if (!this.newDepIds.has(id)) {\n            this.newDepIds.add(id)\n            this.newDeps.push(dep)\n            if (!this.depIds.has(id)) {\n                // 3.\u8ba9dep\u8bb0\u5f55watcher\n                dep.addSub(this) \n            }\n        }\n  }\n  update () {\n      queueWatcher(this)\n  }\n}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"watcher\u4e2d\u4f1a\u8fdb\u884c\u8651\u91cd\u64cd\u4f5c\uff0c\u5b9e\u73b0watcher\u548cdep\u4e92\u76f8\u8bb0\u5fc6")),(0,i.kt)("h2",{id:"\u4e09\u5f02\u6b65\u66f4\u65b0"},"\u4e09.\u5f02\u6b65\u66f4\u65b0"),(0,i.kt)("p",null,"\u4e3a\u4e86\u9632\u6b62\u591a\u6b21\u66f4\u6539\u540c\u4e00\u4e2a\u5c5e\u6027\u6216\u8005\u591a\u6b21\u4fee\u6539\u4e0d\u540c\u5c5e\u6027\uff08\u4ed6\u4eec\u4f9d\u8d56\u7684watcher\u76f8\u540c\uff09 \u4f1a\u5bfc\u81f4\u9891\u7e41\u66f4\u65b0\u6e32\u67d3"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export function queueWatcher (watcher: Watcher) {\n  const id = watcher.id\n  // 1.\u5224\u65adwatcher\u662f\u5426\u5df2\u7ecf\u5b58\u653e\u4e86\n  if (has[id] == null) {\n    has[id] = true\n  // 2.\u5c06watcher\u5b58\u653e\u5230\u961f\u5217\u4e2d\n    queue.push(watcher)\n    // queue the flush\n    if (!waiting) {\n      waiting = true\n      nextTick(flushSchedulerQueue) // \u5728\u4e0b\u4e00\u961f\u5217\u4e2d\u6e05\u7a7aqueue\n    }\n  }\n}\n")))}d.isMDXComponent=!0},3930:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/array.f59c87c8-644789181e6b3cbd3708bda1e0df959f.png"},602:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/entry.fd620404-14faabedd9547b39737be47ae06bda99.png"},6795:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/object.a0219fcb-c3a650e9169ecd84e8316cce4995c822.png"}}]);